/**
 * subclass - v0.1.0 - 2015-08-31
 * https://github.com/msdoom2011/subclass
 *
 * Copyright (c) 2015 Dmitriy Osipishin | msdoom2011@gmail.com
 */
!function(){"use strict";var $;$=function(){var a=!1,b=[],c={};return{createModule:function(a,c,d){function e(b,c){$.Error.create('Specified invalid plug-in module definition while creating module "'+a+'". The required option "'+b+'" was missed or is not '+c+".")}$.Tools.isPlainObject(c)&&(d=c,c=[]),c||(c=[]),this._initialize();for(var f=0;f<b.length;f++){var g=b[f].getName(),h=b[f].getSettingsManager().getPluginOf();h==a&&c.push(g)}c=$.Tools.unique(c);var i=[];for(f=0;f<c.length;f++)if($.Tools.isPlainObject(c[f])){var j=c[f];if(i.push(c[f]),j.name&&"string"==typeof j.name){if($.issetModule(j.name))continue}else e("name","a string");j.file&&"string"==typeof j.file||e("file","a string")}var k=$.Tools.createClassInstance($.Module,a,c,d);if(b.push(k),i.length){var l=k.getLoadManager();for(f=0;f<i.length;f++){var m=i[f].name,n=i[f].file;n.match(/^\^/)||(n="^"+n),function(a,b){l.loadFile(a,function(){k.addPlugin(b)})}(n,m)}}return k.getAPI()},loadModule:function(a,b){return $.Tools.loadJS(a,b)},getModule:function(a){this.issetModule(a)||$.Error.create('Trying to get non existent module "'+a+'".');for(var c=0;c<b.length;c++)if(b[c].getName()==a)return b[c].getAPI()},issetModule:function(a){for(var c=0;c<b.length;c++)if(b[c].getName()==a)return!0;return!1},registerPlugin:function(a){"function"!=typeof a&&$.Error.create("InvalidArgument").argument("the Subclass plugin constructor",!1).expected("a function").received(a).apply();var b=$.Tools.buildClassConstructor(a),d=b.getName();c[d]=b},issetPlugin:function(a){return c.hasOwnProperty(a)},getPlugins:function(){return c},_initialize:function(){if(!a)for(var b in c)if(c.hasOwnProperty(b)){for(var d=c[b],e=d.getDependencies(),f=0;f<e.length;f++)$.issetPlugin(e[f])||$.Error.create('The Subclass plug-in "'+b+'" requires the "'+e+'" plug-in to be installed.');a=!0}}}}(),$.Extension=function(){function a(){}return a.$parent=null,a.$config={supports:[]},a.initialize=function(){},a.getConfig=function(){return this.$config},a.setConfig=function(a){a&&"object"==typeof a||$.Error.create("InvalidArgument").argument("the class configuration object",!1).expected("an object").received(a).apply(),this.$config=a},a}(),$.Extendable=function(){function a(){}return a.$extensions=[],a.registerExtension=function(a){this.$extensions.push(a)},a.getExtensions=function(){return this.$extensions},a.hasExtension=function(a){return this.$extensions.indexOf(a)>=0},a.clearExtensions=function(){this.$extensions=[]},a.prototype.initializeExtensions=function(){for(var a=this.constructor.getExtensions(),b=0;b<a.length;b++)a[b]=$.Tools.buildClassConstructor(a[b]),a[b].initialize(this)},a}(),$.Tools=function(){return{extend:function(a,b,c){if(c!==!0&&(c=!1),"object"!=typeof a&&"object"!=b)return a;if(!Array.isArray(a)&&Array.isArray(b)||Array.isArray(a)&&!Array.isArray(b))return a;if(Array.isArray(a))for(var d=0;d<b.length;d++)a.push(b[d]);else for(var e in b)(b.hasOwnProperty(e)||c)&&(Array.isArray(b[e])?(a[e]=[],a[e]=a[e].concat(b[e])):a[e]=b[e]);return a},extendDeep:function a(b,c,d,e){function f(a,b){for(var c=0;c<a.length;c++)if(h(a[c],b))return!0;return!1}function g(a){return"object"!=typeof a||null===a||a.nodeType||a==window?!1:!(a.constructor&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf"))}e!==!0&&(e=!1),(!d||"boolean"!=typeof d&&"function"!=typeof d)&&(d=!1);var h=!1;"function"==typeof d&&(h=d,d=!0),"object"!=typeof b&&"function"!=typeof b&&(b={});for(var i in c){var j;if((e||c.hasOwnProperty(i))&&b!==c[i])if(c[i]&&(g(c[i])||d&&(j=Array.isArray(c[i])))){var k;if(j&&d){if(j=!1,k=[],b[i]&&Array.isArray(b[i])){for(var l=0;l<c[i].length;l++)(!h||"function"==typeof h&&!f(b[i],c[i][l]))&&b[i].push(c[i][l]);continue}}else k=b[i]&&g(b[i])?b[i]:{};b[i]=a.call(this,k,c[i],h||d,e)}else void 0!==c[i]&&(b[i]=c[i])}return b},copy:function(a){var b;return a&&"object"==typeof a&&(a.constructor==Object||Array.isArray(a))?(b=Array.isArray(a)?[]:Object.create(Object.getPrototypeOf(a)),b=this.extendDeep(b,a,!0)):b=a,b},isEqual:function(a,b){if("function"==typeof a&&"function"==typeof b)return!0;if("object"!=typeof a&&"object"!=typeof b)return a===b;if(typeof a!=typeof b)return!1;if(!a&&b||a&&!b)return!1;if(!a&&!b)return!0;if(a.constructor!=b.constructor)return!1;if(Array.isArray(a)){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(this.isEqual(a[c],b[c])===!1)return!1;return!0}if(this.isPlainObject(a)){if(Object.keys(a).length!=Object.keys(b).length)return!1;for(var d in a)if(a.hasOwnProperty(d)&&this.isEqual(a[d],b[d])===!1)return!1;return!0}return a==b},unique:function(a){var b=[];if(!Array.isArray(a))return a;for(var c=0;c<a.length;c++)b.indexOf(a[c])<0&&b.push(a[c]);return b},getObjectProperties:function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}}}(),$.Tools.ConverterTools=function(){return $.Tools.extend($.Tools,{convertNumberToString:function(a,b){var c=a;if(b||(b=","),"string"==typeof a&&(a=a.replace(/(^\s+)|(\s+$)/g,""),a=a.replace(/(\d+)[\,\s]+(\d+)+/g,"$1$2")),null===a||void 0===a||isNaN(parseFloat(a))||a.toString().match(/.+\-.+/))return c;var d=a.toString().split(".");return d[0]=d[0].replace(/\b(?=(\d{3})+(?!\d))/g,b),d.join(".")},convertStringToNumber:function(a){if("number"==typeof a)return a;if(!a)return 0;if(null===a||void 0===a||isNaN(parseFloat(a))||a.match(/.+\-.+/))return!1;var b=a.replace(/[^0-9,\s]+$/,"").replace(/[\,\s]+/g,"");return isNaN(parseFloat(b))?!1:parseFloat(b)},getNumberSuffix:function(a){if("number"==typeof a||!a)return"";var b=a.match(/[^0-9]+$/);return b&&b.length?b[0]:""},getNumberPrecision:function(a){if(!this.isNumeric(a))return 0;a=String(a);var b=a.match(/\.([0-9])+/i);return b?b[1].length:0}}),$.Tools}(),$.Tools.CheckTools=function(){return $.Tools.extend($.Tools,{isEmpty:function(a){return!a||0===parseFloat(a)||this.isObject(a)&&0==Object.keys(a).length||this.isArray(a)&&0==a.length},isUndef:function(a){return void 0===a},isUndefOrNull:function(a){return this.isUndef(a)||null===a},isNull:function(a){return null===a},isObject:function(a){return null!==a&&"object"==typeof a&&!this.isArray(a)},isPlainObject:function(a){return"object"!=typeof a||null===a||a.nodeType||a==window?!1:!(a.constructor&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf"))},isArray:function(a){return Array.isArray(a)},isBoolean:function(a){return"boolean"==typeof a},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isNumberEven:function(a){return this.isNumber(a)||$.Error.create("Trying to check whether is even the not number value."),a%2==0},isNumeric:function(a){var b=this.convertStringToNumber(a);return b!==!1}}),$.Tools}(),$.Tools.CheckTools=function(){return $.Tools.extend($.Tools,{buildClassConstructor:function(a){function b(a,b){for(var c in b)b.hasOwnProperty(c)&&["$parent","$mixins"].indexOf(c)<0&&(a[c]=b[c]);return a}function c(a,b){for(var c=0;c<b.length;c++)$.Tools.extend(a,b[c].prototype)}function d(a,b){for(var c=0;c<b.length;c++)$.Tools.extend(a,$.Tools.getObjectProperties(b[c]))}if(a.$built)return a;var e=a.prototype,f={},g={},h={};if($.Tools.extend(f,$.Tools.getObjectProperties(e)),$.Tools.extend(h,$.Tools.getObjectProperties(a)),a.$parent){var i=this.buildClassConstructor(a.$parent);e=Object.create(i.prototype),b(g,i),a.$mixins&&(c(e,a.$mixins),d(a,a.$mixins))}else a.$mixins&&(c(e,a.$mixins),d(a,a.$mixins));return a.prototype=$.Tools.extend(e,f),$.Tools.extend(g,h),b(a,g),Object.defineProperty(a.prototype,"constructor",{enumerable:!1,configurable:!0,value:a}),Object.defineProperty(a,"$built",{enumerable:!1,value:!0}),$.Extendable&&a.prototype instanceof $.Extendable&&(a.$extensions=$.Tools.copy(a.$extensions)),a},createClassInstance:function(a){function b(a){var c={};if(a.$parent&&$.Tools.extend(c,b(a.$parent)),a.$mixins)for(var d=0;d<a.$mixins.length;d++){var e=a.$mixins[d]();$.Tools.extend(c,e)}return c}a=this.buildClassConstructor(a);var c=b(a),d=new(a.bind.apply(a,arguments));for(var e in c)c.hasOwnProperty(e)&&!d.hasOwnProperty(e)&&(d[e]=c[e]);return d}}),Function.prototype.bind||Object.defineProperty(Function.prototype,"bind",{enumerable:!1,configurable:!0,value:function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}}),$.Tools}(),$.Tools.LoadingTools=function(){function a(a,b){a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of file",!1).received(a).expected("a string").apply(),b&&"function"!=typeof b&&!this.isPlainObject(b)&&$.Error.create("InvalidArgument").argument('the callback when trying to load file "'+a+'"',!1).received(b).expected("a function").apply();var c,d;return"function"==typeof b&&(d=b),"object"==typeof b&&(c=b.before,d=b.after),{afterCallback:d,beforeCallback:c}}return $.Tools.extend($.Tools,{loadJS:function(b,c){var d=a(b,c),e=new XMLHttpRequest,f=document.querySelectorAll("script"),g=f[f.length-1];return e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.text=e.responseText,a.text?g&&(d.beforeCallback&&d.beforeCallback(),g.parentNode.insertBefore(a,g.nextSibling),d.afterCallback&&d.afterCallback()):$.Error.create('Loading file "'+b+'" failed.')}else 200!==e.status&&0!==e.status&&$.Error.create('Loading file "'+b+'" failed.')},e.open("GET",b,!0),e.send(),e},loadCSS:function(b,c){var d=a(b,c),e=new XMLHttpRequest;return e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.text=e.responseText,a.text?(d.beforeCallback&&d.beforeCallback(),window.document.getElementsByTagName("HEAD")[0].appendChild(a),d.afterCallback&&d.afterCallback()):$.Error.create('Loading file "'+b+'" failed.')}else 200!==e.status&&0!==e.status&&$.Error.create('Loading file "'+b+'" failed.')},e.open("GET",b,!0),e.send(),e}}),$.Tools}(),$.Tools.PropertyTools=function(){function a(a,b){["get","set","is","validate"].indexOf(a)<0&&$.Error.create('Invalid accessor type! It can be only "get", "set", "is" or "validate".');for(var c=b.split("_"),d=0;d<c.length;d++)""!==c[d]&&(c[d]=c[d][0].toUpperCase()+c[d].substr(1));return a+c.join("")}return $.Tools.extend($.Tools,{generateGetterName:function(b){return a("get",b)},generateSetterName:function(b){return a("set",b)},generateCheckerName:function(b){return a("is",b)},generateValidatorName:function(b){return a("validate",b)}}),$.Tools}(),$.Error=function(){return{_types:{},create:function(a){if(!this.issetType(a)){var b=a;return $.Tools.createClassInstance($.Error.ErrorBase,b).apply()}return $.Tools.createClassInstance(this.getType(a))},registerType:function(a,b){if(!a||"string"!=typeof a)throw new Error("Specified invalid name of registering error type. It must be a string");if(!b||"function"!=typeof b)throw new Error("Specified invalid constructor of registering error type. It must be a function.");if(this.issetType(a))throw new Error("Can't register error type \""+a+"\". It's already exists");this._types[a]=b},getType:function(a){if(!this.issetType(a))throw new Error("Trying to get not registered error type constructor.");return this._types[a]},issetType:function(a){return!!this._types[a]}}}(),$.Error.ErrorManager=$.Error,$.Error.Type={},$.Error.ErrorBase=function(){function a(a){a||(a=void 0),this._message=a}return a.prototype.buildMessage=function(){return this._message?this._message:""},a.prototype.message=function(a){if(!arguments.length)return this.buildMessage();if(a&&"string"!=typeof a)throw new Error("Specified invalid error message. It must be a string.");return this._message=a,this},a.prototype.hasMessage=function(){return void 0!==this._message},a.prototype.apply=function(){throw $.Error.ErrorBase.validateRequiredOptions(this),new Error(this.message())},a.getName=function(){throw new Error('Not implemented method "getName".')},a.getRequiredOptions=function(){return[]},a.validateRequiredOptions=function(a){var b=this.getRequiredOptions(),c=[];b.indexOf("message")>=0&&b.splice(b.indexOf("message"),1);for(var d=0;d<b.length;d++){var e="has"+b[d][0].toUpperCase()+b[d].substr(1);a[e]()||c.push(b[d])}if(c.length)throw new Error("Can't build error message. There are not specified error options: \""+c.join('", "')+'".')},a}(),$.Error.Option={},$.Error.Option.Argument=function(){function a(){return{_argument:void 0}}return a.prototype.argument=function(a,b){if(!arguments.length)return this._argument;if(a&&"string"!=typeof a)throw new Error("Specified invalid argument name. It must be a string.");b!==!1&&(b=!0);var c=[a];return b&&(c.unshift('"'),c.push('"')),this._argument=c.join(""),this},a.prototype.hasArgument=function(){return void 0!==this._argument},a}(),$.Error.Option.ClassName=function(){function a(){return{_className:void 0}}return a.prototype.className=function(a){if(!arguments.length)return this._className;if(a&&"string"!=typeof a)throw new Error("Specified invalid class name. It must be a string.");return this._className=a,this},a.prototype.hasClassName=function(){return void 0!==this._className},a}(),$.Error.Option.Expected=function(){function a(){return{_expected:void 0}}return a.prototype.expected=function(a){if(!arguments.length)return this._expected;if(a&&"string"!=typeof a)throw new Error("Invalid expected argument value. It must be a string");return this._expected=a,this},a.prototype.hasExpected=function(){return void 0!==this._expected},a}(),$.Error.Option.Method=function(){function a(){return{_method:void 0,_methodStatic:!1}}return a.prototype.method=function(a,b){if(!arguments.length)return this._method;if(a&&"string"!=typeof a)throw new Error("Specified invalid method option. It must be a string.");if(this._method=a,arguments.length>=2&&"boolean"!=typeof b)throw new Error("Specified invalid isStatic option. It must be a boolean.");return this._methodStatic=b,this},a.prototype.hasMethod=function(){return void 0!==this._method},a.prototype.isMethodStatic=function(){return this._methodStatic},a}(),$.Error.Option.Module=function(){function a(){return{_module:void 0}}return a.prototype.module=function(a){if(!arguments.length)return this._module;if(a&&"string"!=typeof a)throw new Error("Specified invalid module name. It must be a string.");return this._module=a,this},a.prototype.hasModule=function(){return void 0!==this._module},a}(),$.Error.Option.Option=function(){function a(){return{_option:void 0}}return a.prototype.option=function(a,b){if(!arguments.length)return this._option;if(a&&"string"!=typeof a)throw new Error("Specified invalid option name. It must be a string.");b!==!1&&(b=!0);var c=[a];return b&&(c.unshift('"'),c.push('"')),this._option=c.join(""),this},a.prototype.hasOption=function(){return void 0!==this._option},a}(),$.Error.Option.Received=function(){function a(){return{_received:void 0}}return a.prototype.received=function(a){if(!arguments.length){var b=this._received,c="";return c+=b&&"object"==typeof b&&b.$_className?'The instance of class "'+b.$_className+'" was received instead.':b&&"object"==typeof b?'The object with type "'+b.constructor.name+'" was received instead.':null===b?"Null was received instead.":'The value with type "'+typeof b+'" was received instead.'}return this._received=a,this},a.prototype.hasReceived=function(){return void 0!==this._received},a}(),$.Error.Type.InvalidArgumentError=function(){function a(b){a.$parent.call(this,b)}return a.$parent=$.Error.ErrorBase,a.$mixins=[$.Error.Option.Argument,$.Error.Option.Expected,$.Error.Option.Received],a.getName=function(){return"InvalidArgument"},a.getRequiredOptions=function(){var b=a.$parent.getRequiredOptions();return b.concat(["argument"])},a.prototype.buildMessage=function(){var b=a.$parent.prototype.buildMessage.call(this);return b||(b+="Specified invalid value of "+this.argument()+". ",b+=this.hasExpected()?"It must be "+this.expected()+". ":"",b+=this.hasReceived()?this.received():""),b},$.Error.registerType(a.getName(),a),a}(),$.Error.InvalidClassOptionError=function(){function a(b){a.$parent.call(this,b)}return a.$parent=$.Error.ErrorBase,a.$mixins=[$.Error.Option.ClassName,$.Error.Option.Expected,$.Error.Option.Received,$.Error.Option.Option],a.getName=function(){return"InvalidClassOption"},a.getRequiredOptions=function(){var b=a.$parent.getRequiredOptions();return b.concat(["className","option"])},a.prototype.buildMessage=function(){var b=a.$parent.prototype.buildMessage.call(this);return b||(b+="Invalid value of option "+this.option()+" ",b+='in definition of class "'+this.className()+'". ',b+=this.hasExpected()?"It must be "+this.expected()+". ":"",b+=this.hasReceived()?this.received():""),b},$.Error.registerType(a.getName(),a),a}(),$.Error.InvalidModuleOptionError=function(){function a(b){a.$parent.call(this,b)}return a.$parent=$.Error.ErrorBase,a.$mixins=[$.Error.Option.Option,$.Error.Option.Module,$.Error.Option.Expected,$.Error.Option.Received],a.getName=function(){return"InvalidModuleOption"},a.getRequiredOptions=function(){var b=a.$parent.getRequiredOptions();return b.concat(["module","option"])},a.prototype.buildMessage=function(){var b=a.$parent.prototype.buildMessage.call(this);return b||(b+='Invalid value of option "'+this.option()+'" ',b+='in settings of module "'+this.module()+'". ',b+=this.hasExpected()?"It must be "+this.expected()+". ":"",b+=this.hasReceived()?this.received():""),b},$.Error.registerType(a.getName(),a),a}(),$.Error.MissedArgumentError=function(){function a(b){a.$parent.call(this,b)}return a.$parent=$.Error.ErrorBase,a.$mixins=[$.Error.Option.Argument],a.getName=function(){return"MissedArgument"},a.getRequiredOptions=function(){var b=a.$parent.getRequiredOptions();return b.concat(["argument"])},a.prototype.buildMessage=function(){var b=a.$parent.prototype.buildMessage.call(this);return b||(b+="The "+this.argument()+" argument is required but was missed."),b},$.Error.registerType(a.getName(),a),a}(),$.Error.NotExistentMethodError=function(){function a(b){a.$parent.call(this,b)}return a.$parent=$.Error.ErrorBase,a.$mixins=[$.Error.Option.ClassName,$.Error.Option.Method],a.getName=function(){return"NotExistentMethod"},a.getRequiredOptions=function(){var b=a.$parent.getRequiredOptions();return b.concat(["className","method"])},a.prototype.buildMessage=function(){var b=a.$parent.prototype.buildMessage.call(this);return b||(b+="The "+(this.isMethodStatic()?"static ":"")+"method ",b+='"'+this.className()+"#"+this.method()+'" does not exist.'),b},$.Error.registerType(a.getName(),a),a}(),$.Error.NotImplementedMethodError=function(){function a(b){a.$parent.call(this,b)}return a.$parent=$.Error.ErrorBase,a.$mixins=[$.Error.Option.ClassName,$.Error.Option.Method],a.getName=function(){return"NotImplementedMethod"},a.getRequiredOptions=function(){var b=a.$parent.getRequiredOptions();return b.concat(["className","method"])},a.prototype.buildMessage=function(){var b=a.$parent.prototype.buildMessage.call(this);return b||(b+="The "+(this.isMethodStatic()?"static ":"")+"method ",b+='"'+this.className()+"#"+this.method()+'" ',b+="is abstract and should be implemented."),b},$.Error.registerType(a.getName(),a),a}(),$.Parser={},$.Parser.ParserManager=function(){function a(a){a&&a instanceof $.Module||$.Error.create("InvalidArgument").argument("the module instance",!1).expected('an instance of class "Subclass.Module"').received(a).apply(),this._module=a,this._parsers={};for(var c in b)b.hasOwnProperty(c)&&(this._parsers[c]=$.Tools.createClassInstance(b[c],this),this._parsers[c]instanceof $.Parser.ParserAbstract||$.Error.create('Registered invalid parser. It should be instance of class "Subclass.Parser.ParserAbstract".'))}var b=[];return a.registerParser=function(a){"function"==typeof a&&a.getName||$.Error.create('Trying to register invalid parser. It should be instance of class "Subclass.Parser.ParserAbstract".'),b[a.getName()]=a},a.getParser=function(a){return this.issetParser(a)||$.Error.create('Trying to get non registered parser constructor named "'+a+'"'),b[a]},a.issetParser=function(a){return b.hasOwnProperty(a)},a.prototype={getModule:function(){return this._module},get:function(a){return this.isset(a)||$.Error.create('Trying to get non registered parser named "'+a+'"'),this._parsers[a]},isset:function(a){return this._parsers.hasOwnProperty(a)},remove:function(a){delete this._parsers[a]},parse:function(a){var b=this._parsers;for(var c in b)b.hasOwnProperty(c)&&(a=b[c].parse(a));return a}},a}(),$.Parser.ParserAbstract=function(){function a(a){a&&a instanceof $.Parser.ParserManager||$.Error.create("InvalidArgument").argument("the parser manager instance",!1).expected('an instance of class "Subclass.Parser.ParserManager"').received(a).apply(),this._parserManager=a}return a.getName=function(){$.Error.create("NotImplementedMethod").className("Subclass.Parser.ParserAbstract").method("getName",!0).apply()},a.prototype={getParserManager:function(){return this._parserManager},getModule:function(){return this.getParserManager().getModule()},parse:function(){$.Error.create("NotImplementedMethod").className("Subclass.Parser.ParserAbstract").method("parse").apply()}},a}(),$.Event={},$.Event.Event=function(){function a(a,b){a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the event name",!1).received(a).expected("a string").apply(),b||(b={}),this._name=a,this._context=b,this._listeners=[],this._defaultListener=null}return a.prototype.getName=function(){return this._name},a.prototype.getContext=function(){return this._context},a.prototype.setDefaultListener=function(a){return"function"!=typeof a&&$.Error.create("InvalidArgument").argument("the default event listener",!1).expected("a function").received(a).apply(),this._defaultListener=a,this},a.prototype.getDefaultListener=function(){return this._defaultListener},a.prototype.addListener=function(a,b){var c=$.Tools.createClassInstance($.Event.EventListener,a,b);return this._listeners.push(c),this},a.prototype.removeListener=function(a){var b=this.getListenerByCallback(a);if(!b)return this;var c=this.getListeners(),d=c.indexOf(b);return d>=0&&c.splice(d,1),this},a.prototype.getListeners=function(){return this._listeners},a.prototype.getListenerByCallback=function(a){a&&"Function"==typeof a||$.Error.create("InvalidArgument").argument("the callback",!1).received(a).expected("a function").apply();for(var b=this.getListeners(),c=0;c<b.length;c++)if(b[c].getCallback()==a)return b[c];return null},a.prototype.hasListeners=function(){return!!this.getListeners().length},a.prototype.trigger=function(){var a=this.getListeners();return this._processTrigger(a,arguments)},a.prototype._processTrigger=function(a,b){for(var c="_passed_"+Math.round((new Date).getTime()*Math.random()),d=$.Tools.createClassInstance($.Event.EventData,this,this.getContext()),e=this.getContext(),f=[d],g=[],h=0;h<b.length;h++)f.push(b[h]);for(var i=0;i<a.length;i++){var j=a[i];g.push(j.getPriority()),j[c]=!1}g=g.sort(function(a,b){return a=parseInt(a),b=parseInt(b),a>b?-1:b>a?1:0});a:for(i=0;i<g.length;i++)for(var k=0;k<a.length;k++)if(j=a[k],!j[c]&&j.getPriority()==g[i]){j[c]=!0;var l=j.getCallback().apply(e,f);if(d.addResult(l),d.isPropagationStopped())break a}for(!this.getDefaultListener()||d.isPropagationStopped()||d.isDefaultPrevented()||this.getDefaultListener().apply(e,f),i=0;i<a.length;i++)j=a[i],delete j[c];return d},a}(),$.Event.EventData=function(){function a(a,b){this._event=a,this._target=b,this._results=[],this._stopped=!1,this._defaultPrevented=!1}return a.prototype.getEvent=function(){return this._event},a.prototype.getTarget=function(){return this._target},a.prototype.startPropagation=function(){this._stopped=!1},a.prototype.stopPropagation=function(){this._stopped=!0},a.prototype.isPropagationStopped=function(){return this._stopped},a.prototype.preventDefault=function(){this._defaultPrevented=!0},a.prototype.allowDefault=function(){this._defaultPrevented=!1},a.prototype.isDefaultPrevented=function(){return this._defaultPrevented},a.prototype.addResult=function(a){this._results.push(a)},a.prototype.getResults=function(){return this._results},a.prototype.getFirstResult=function(){return this._results.length?this._results[0]:void 0},a.prototype.getLastResult=function(){return this._results.length?this._results[this._results.length-1]:void 0},a.prototype.clearResults=function(){this._results=[]},a}(),$.Event.EventListener=function(){function a(a,b){"function"==typeof a&&(b=a,a=0),"number"!=typeof a&&$.Error.create("InvalidArgument").argument("the priority of event listener",!1).received(a).expected("a number").apply(),"function"!=typeof b&&$.Error.create("InvalidArgument").argument("the callback",!1).received(b).expected("a function").apply(),this._priority=a,this._callback=b}return a.prototype.getPriority=function(){return this._priority},a.prototype.getCallback=function(){return this._callback},a}(),$.Event.EventableMixin=function(){function a(){return{_events:{}}}return a.prototype.getEvents=function(){return this._events},a.prototype.registerEvent=function(a){return this.issetEvent(a)?this:(this._events[a]=$.Tools.createClassInstance($.Event.Event,a,this),this)},a.prototype.getEvent=function(a){return this.issetEvent(a)||$.Error.create('Trying to get non existent event "'+a+'".'),this.getEvents()[a]},a.prototype.issetEvent=function(a){return!!this.getEvents()[a]},a}(),$.Module=function(){function a(b,c,d){var e=this;b&&"string"==typeof b||$.Error.create("InvalidArgument").argument("the name of module",!1).received(b).expected("a string").apply(),d||(d={}),c||(c=[]),this._name=b,this._parent=null,this._api=$.Tools.createClassInstance($.ModuleAPI,this),this._eventManager=$.Tools.createClassInstance($.EventManager,this),this.getEventManager().registerEvent("onCreate").registerEvent("onInitializeBefore").registerEvent("onInitialize").registerEvent("onInitializeAfter").registerEvent("onSetup").registerEvent("onReady").registerEvent("onReadyBefore").registerEvent("onReadyAfter").registerEvent("onAddPlugin"),this._loadManager=$.Tools.createClassInstance($.LoadManager,this),this._moduleStorage=$.Tools.createClassInstance($.ModuleStorage,this,c),this._classManager=$.Tools.createClassInstance($.ClassManager,this),this._settingsManager=$.Tools.createClassInstance($.SettingsManager,this),this._parserManager=$.Tools.createClassInstance($.Parser.ParserManager,this),this._setupped=!1,this._prepared=!1,this._ready=!1;for(var f=this.getEventManager(),g=0;g<a._creaters.length;g++)f.getEvent("onCreate").addListener(a._creaters[g]);for(g=0;g<a._initializersBefore.length;g++)f.getEvent("onInitializeBefore").addListener(a._initializersBefore[g]);for(g=0;g<a._initializersAfter.length;g++)f.getEvent("onInitializeAfter").addListener(a._initializersAfter[g]);f.getEvent("onCreate").triggerPrivate(this),f.getEvent("onInitializeBefore").triggerPrivate(this),this.initializeExtensions(),f.getEvent("onInitialize").triggerPrivate(this),this.setSettings(d),this.getClassManager().initialize(),this.getLoadManager().initialize(),f.getEvent("onInitializeAfter").triggerPrivate(this),f.getEvent("onLoadingEnd").addListener(1e6,function(){e.isRoot()&&e.setSetupped()}),f.getEvent("onLoadingEnd").addListener(-1e6,function(){e.setReady()})}return a.$parent=$.Extendable,a._creaters=[],a._initializersBefore=[],a._initializersAfter=[],a.onInitializeBefore=function(a){a&&"function"==typeof a||$.Error.create("InvalidArgument").argument("the callback function",!1).expected("a function").received(a).save(),this._initializersBefore.indexOf()<0&&this._initializersBefore.push(a)},a.onCreate=function(a){a&&"function"==typeof a||$.Error.create("InvalidArgument").argument("the callback function",!1).expected("a function").received(a).save(),this._creaters.indexOf()<0&&this._creaters.push(a)},a.onInitializeAfter=function(a){a&&"function"==typeof a||$.Error.create("InvalidArgument").argument("the callback function",!1).expected("a function").received(a).save(),this._initializersAfter.indexOf()<0&&this._initializersAfter.push(a)},a.prototype.getName=function(){return this._name},a.prototype.setParent=function(a){null===a||a instanceof $.Module||$.Error.create("InvalidArgument").argument("the parent module instance",!1).received(a).expected('an instance of "Subclass.Module"').apply(),this._parent=a},a.prototype.getParent=function(){return this._parent},a.prototype.hasParent=function(){return!!this._parent},a.prototype.getRoot=function(){return this.hasParent()?this.getParent().getRoot():this},a.prototype.isRoot=function(){return!this.hasParent()&&!this.isPlugin()},a.prototype.isPlugin=function(){return this.getSettingsManager().isPlugin()},a.prototype.getAPI=function(){return this._api},a.prototype.setSettings=function(a){return this.getSettingsManager().setSettings(a),this},a.prototype.getSettingsManager=function(){return this._settingsManager},a.prototype.getParserManager=function(){return this._parserManager},a.prototype.getEventManager=function(){return this._eventManager},a.prototype.getModuleStorage=function(){return this._moduleStorage},a.prototype.getLoadManager=function(){return this._loadManager},a.prototype.getClassManager=function(){return this._classManager},a.prototype.onSetup=function(a){return this.getSettingsManager().setOnSetup(a),this},a.prototype.setSetupped=function(){this.triggerOnSetup(),this._setupped=!0},a.prototype.isSetupped=function(){return this._setupped},a.prototype.triggerOnSetup=function(){return this.getEventManager().getEvent("onSetup").trigger(),this},a.prototype.onReady=function(a){return this.getSettingsManager().setOnReady(a),this},a.prototype.triggerOnReady=function(){return this.getEventManager().getEvent("onReady").trigger(),this},a.prototype.setPrepared=function(){this._prepared=!0},a.prototype.isPrepared=function(){return this._prepared},a.prototype.setReady=function(){if(!this.isReady()){var a=this.getLoadManager();if(this.setPrepared(),a.isStackEmpty()&&this.isPluginsReady()){if(this._ready=!0,this.isPlugin()&&this.hasParent()){var b=this.getRoot(),c=b.getModuleStorage();if(c.issetLazyModule(this.getName())&&c.resolveLazyModule(this.getName()),!b.isReady())return b.setReady()}(this.isRoot()||this.isPlugin()&&this.hasParent()&&this.getRoot().isReady())&&(this.isSetupped()||this.setSetupped(),this.getEventManager().getEvent("onReadyBefore").trigger(),this.triggerOnReady(),this.getEventManager().getEvent("onReadyAfter").trigger())}}},a.prototype.isReady=function(){return this._ready},a.prototype.isPluginsReady=function(){var a=this.getModuleStorage(),b=a.getPlugins();if(a.hasLazyModules())return!1;for(var c=0;c<b.length;c++)if(!b[c].isPrepared()||!b[c].isPluginsReady())return!1;
return!0},a.prototype.addPlugin=function(a,b,c){var d=this.getLoadManager(),e=this;if(a&&"string"==typeof a?$.issetModule(a)&&$.getModule(a).getParentModule()&&$.Error.create('The module "'+a+'" is already added as a plug-in to another module.'):$.Error.create("InvalidArgument").argument("the name of module",!1).received(a).expected("a string").apply(),b&&"string"!=typeof b&&$.Error.create("InvalidArgument").argument("the name of module",!1).received(b).expected("a string or be omitted").apply(),c&&"function"!=typeof c&&$.Error.create("InvalidArgument").argument("the callback",!1).received(c).expected("a function").apply(),!b&&c&&$.Error.create("You can't specify the callback function without file of module \""+a+'".'),b)return void d.loadFile(b,function(){if(c){var b=$.getModule(a).getModule(),d=b.getEventManager();d.getEvent("onLoadingEnd").addListener(c)}e.addPlugin(a)});var f=this.getEventManager(),g=this.getModuleStorage();if(g.addPlugin(a),this.isPrepared()){var h=$.getModule(a).getModule(),i=h.getEventManager(),j=h.getLoadManager();h.isPrepared()?f.getEvent("onAddPlugin").triggerPrivate(h):(j.startLoading(),i.getEvent("onLoadingEnd").addListener(1e5,function(){f.getEvent("onAddPlugin").triggerPrivate(h)}))}return this},a.prototype.hasPlugins=function(){return!!this.getModuleStorage().getPlugins().length},a}(),$.ModuleAPI=function(){function a(a){this._module=a,this._events=[],this.registerEvent("onInitialize"),this.initializeExtensions(),this.getEvent("onInitialize").trigger()}return a.$parent=$.Extendable,a.$mixins=[$.Event.EventableMixin],a.prototype.getModule=function(){return this._module},a.prototype.getName=function(){return this.getModule().getName.apply(this.getModule(),arguments)},a.prototype.addPlugin=function(){return this.getModule().addPlugin.apply(this.getModule(),arguments)},a.prototype.getClass=function(){return this.getModule().getClassManager().get.apply(this.getModule().getClassManager(),arguments)},a.prototype.issetClass=function(){return this.getModule().getClassManager().isset.apply(this.getModule().getClassManager(),arguments)},a.prototype.buildClass=function(){return this.getModule().getClassManager().build.apply(this.getModule().getClassManager(),arguments)},a.prototype.alterClass=function(){return this.getModule().getClassManager().alter.apply(this.getModule().getClassManager(),arguments)},a.prototype.copyClass=function(){return this.getModule().getClassManager().copy.apply(this.getModule().getClassManager(),arguments)},a.prototype.onSetup=function(){return this.getModule().onSetup.apply(this.getModule(),arguments)},a.prototype.triggerOnSetup=function(){return this.getModule().triggerOnSetup.apply(this.getModule(),arguments)},a.prototype.isSetupped=function(){return this.getModule().isSetupped.apply(this.getModule(),arguments)},a.prototype.onReady=function(){return this.getModule().onReady.apply(this.getModule(),arguments)},a.prototype.triggerOnReady=function(){return this.getModule().triggerOnReady.apply(this.getModule(),arguments)},a.prototype.isReady=function(){return this.getModule().isReady.apply(this.getModule(),arguments)},a.prototype.setSettings=function(){return this.getModule().setSettings.apply(this.getModule(),arguments)},a.prototype.getSettingsManager=function(){return this.getModule().getSettingsManager.apply(this.getModule(),arguments)},a.prototype.getEventManager=function(){return this.getModule().getEventManager.apply(this.getModule(),arguments)},a.prototype.getLoadManager=function(){return this.getModule().getLoadManager.apply(this.getModule(),arguments)},a.prototype.getClassManager=function(){return this.getModule().getClassManager.apply(this.getModule(),arguments)},a.prototype.getRootModule=function(){return this.getModule().getRoot.apply(this.getModule(),arguments)},a.prototype.isRootModule=function(){return this.getModule().isRoot.apply(this.getModule(),arguments)},a.prototype.getParentModule=function(){var a=this.getModule().getParent.apply(this.getModule(),arguments);return a==this.getModule()&&(a=null),a},a}(),$.ClassManager=function(){function a(a){a&&a instanceof $.Module||$.Error.create("InvalidArgument").argument("the module instance").received(a).expected("an instance of Subclass.Module class").apply(),this._module=a,this._classes={},this._loader=$.Tools.createClassInstance($.Class.ClassLoader,this)}return a.prototype.initialize=function(){var b=this.getModule(),c=this;if(b.isRoot()){var d=a.getClasses();for(var e in d)if(d.hasOwnProperty(e))for(var f in d[e])if(d[e].hasOwnProperty(f)&&!this.isset(f)){var g=d[e][f];this.add(e,f,g)}}var h=b.getEventManager();h.getEvent("onLoadingEnd").addListener(function(){c.checkForClones(),c.initializeClasses()}),h.getEvent("onAddPlugin").addListener(function(a,b){c.checkForClones(),b.getClassManager().initializeClasses()}),setTimeout(function(){if(b.isRoot()){var d=Object.keys(c.getClasses()).length,e=Object.keys(a.getClasses()).length;d==e&&b.getLoadManager().startLoading()}},20)},a.prototype.initializeClasses=function(){var a=this.getClasses();for(var b in a)a.hasOwnProperty(b)&&a[b].createConstructor()},a.prototype.getModule=function(){return this._module},a.prototype.getLoader=function(){return this._loader},a.prototype.getClasses=function(a,b){var c=this.getModule(),d=c.getModuleStorage(),e={},f=this;return a!==!0&&(a=!1),b!==!1&&(b=!0),a||!b||c.isRoot()||arguments[2]==c?a?this._classes:(d.eachModule(function(a){if(a==c)return void $.Tools.extend(e,f.getClasses(!0,!1));var b=a.getClassManager(),d=b.getClasses(!1,!1);$.Tools.extend(e,d)}),e):c.getRoot().getClassManager().getClasses(!1,!1,c)},a.prototype.isEmpty=function(){return $.Tools.isEmpty(this._classes)},a.prototype.findLocations=function(a){var b=this.getModule().getRoot(),c=[];arguments[1]&&(b=arguments[1]);var d=this.getModule().getModuleStorage();return d.eachModule(function(d){var e=d.getClassManager();if(e.isset(a,!0)&&c.push(d.getName()),d!=b&&d.hasPlugins())for(var f=d.getModuleStorage(),g=f.getPlugins(),h=0;h<g.length;h++){var i=g[h],j=i.getClassManager(),k=j.findLocations(a,i);c=c.concat(k)}}),c},a.prototype.checkForClones=function(){var b=this.getModule(),c=b.getModuleStorage(),d=this,e={};c.eachModule(function(c){if(c==b)return void $.Tools.extend(e,d._classes);var f=c.getClassManager(),g=f.getClasses(!1,!1);for(var h in g)if(g.hasOwnProperty(h)&&!a.isset(h)){if(e[h]){var i=d.findLocations(h);$.Error.create('Multiple class definition detected. Class "'+h+'" defined in modules: "'+i.join('", "')+'".')}e[h]=1}})},a.prototype.load=function(){var a=this.getLoader();a.loadClass.apply(a,arguments)},a.prototype.create=function(a,b,c){return $.Tools.createClassInstance(a,this,b,c)},a.prototype.add=function(a,b,c){a||$.Error.create('Trying to register the class "'+b+'" without specifying class type.'),$.ClassManager.issetType(a)||$.Error.create('Trying to register the class "'+b+'" of unknown class type "'+a+'".'),b&&"string"==typeof b||$.Error.create('Trying to register the class with wrong name "'+b+'".'),c&&"object"==typeof c||$.Error.create('Trying to register the class "'+b+'" with empty or not valid class definition.'),this.isset(b)&&$.Error.create('Trying to define class with already existed class name "'+b+'".');var d=$.ClassManager.getType(a),e=this.create(d,b,c);return this._classes[b]=e,this.getLoader().setClassLoaded(b),e},a.prototype.get=function(a){return this.isset(a)||$.Error.create('Trying to call to none existed class "'+a+'".'),this.getClasses()[a]},a.prototype.isset=function(a,b){var c=!0;return b===!0&&(c=!1),!!this.getClasses(b,c)[a]},a.prototype.build=function(a,b){return this.createBuilder(a,b)},a.prototype.alter=function(a){return this.createBuilder(null,a)},a.prototype.copy=function(a,b){var c=this.get(a),d=c.getDefinition().getData(),e=this.add(c.getType(),b,d);return e.createConstructor(),e},a.prototype.createBuilder=function(a,b){var c=null;return a||!b||this.isset(b)||$.Error.create("Can't alter definition of class \""+b+'". It does not exists.'),c=!a&&b?this.get(b).constructor.getBuilderClass():$.ClassManager.getType(a).getBuilderClass(),$.Tools.createClassInstance(c,this,a,b)},a._classes={},a._classTypes={},a.getClasses=function(){return this._classes},a.register=function(a,b,c){this.isset(b)&&$.Error.create('The class "'+b+'" is already registered.'),this._classes[a]||(this._classes[a]={}),this._classes[a][b]=c},a.isset=function(a){for(var b in this._classes)if(this._classes.hasOwnProperty(b)&&this._classes[b][a])return!0;return!1},a.registerType=function(a){var b=a.getClassTypeName();this._classTypes[b]=a,$.ModuleAPI.prototype["register"+b]=function(b,c){return this.getModule().getClassManager().add(a.getClassTypeName(),b,c)}},a.getType=function(a){return this.issetType(a)||$.Error.create('Trying to get non existed class type factory "'+a+'".'),this._classTypes[a]},a.issetType=function(a){return!!this._classTypes[a]},a.getTypes=function(){return this._classTypes},a}(),$.Class={},$.Class.Type={},$.Class.ClassType=function(){function ClassType(a,b,c){a||$.Error.create("InvalidArgument").argument("the class manager instance",!1).received(a).expected("an instance of Subclass.ClassManager class").apply(),b&&"string"==typeof b||$.Error.create("InvalidArgument").argument("the name of class",!1).received(b).expected("a string").apply(),c||"object"==typeof c||$.Error.create("InvalidArgument").argument("the definition of class",!1).received(c).expected("a plain object").apply(),this._classManager=a,this._name=b,this._definition=c,this._constructor=null,this._parent=null,this._constants=[],this._children=[],this._created=!1,this._events=[],this.registerEvent("onInitialize").registerEvent("onCreateClassBefore").registerEvent("onCreateClass").registerEvent("onCreateClassAfter").registerEvent("onCreateInstanceBefore").registerEvent("onCreateInstance").registerEvent("onCreateInstanceAfter").registerEvent("onAddChildClass").registerEvent("onRemoveChildClass").registerEvent("onGetClassChildren").registerEvent("onGetClassParents").registerEvent("onSetParent").registerEvent("onSetConstant"),this.initialize()}return ClassType.$parent=$.Extendable,ClassType.$mixins=[$.Event.EventableMixin],ClassType.getClassTypeName=function(){$.Error.create("NotImplementedMethod").method("getClassTypeName").apply()},ClassType.getBuilderClass=function(){$.Error.create("NotImplementedMethod").method("getBuilderClass").apply()},ClassType.getDefinitionClass=function(){return $.Class.ClassDefinition},ClassType.prototype.initialize=function(){this.initializeExtensions(),this.getEvent("onInitialize").trigger(),this._definition=this.createDefinition(this._definition);var a=this.getDefinition();a.processRelatedClasses()},ClassType.prototype.getType=function(){return this.constructor.getClassTypeName()},ClassType.prototype.getClassManager=function(){return this._classManager},ClassType.prototype.getName=function(){return this._name},ClassType.prototype.createDefinition=function(a){return $.Tools.createClassInstance(this.constructor.getDefinitionClass(),this,a)},ClassType.prototype.setDefinition=function(a){for(var b=this.getClassChildren(),c=this.getClassParents(),d=this.getClassManager(),e=0;e<c.length;e++){var f=d.get(c[e]);f.removeChildClass(this.getName())}this.constructor.call(this,this.getClassManager(),this.getName(),a),this._children=b,this.createConstructor()},ClassType.prototype.getDefinition=function(){return this._definition},ClassType.prototype.addChildClass=function(a){if(a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of child class",!1).expected("a string").received(a).apply(),!this.hasChild(a)){this._children.push(a);for(var b=this.getClassManager(),c=b.get(a),d=c.getClassChildren(),e=this.getClassParents(),f=0;f<e.length;f++){var g=b.get(e[f]);g.addChildClass(a)}for(f=0;f<d.length;f++)this.hasChild(d[f])||this.addChildClass(d[f]);this.getEvent("onAddChildClass").trigger(a)}},ClassType.prototype.hasChild=function(a){return this._children.indexOf(a)>=0},ClassType.prototype.removeChildClass=function(a){a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of child class",!1).expected("a string").received(a).apply();var b=this._children.indexOf(a);b>=0&&this._children.splice(b,1),this.hasParent()&&this.getParent().removeChildClass(a),this.getEvent("onRemoveChildClass").trigger(a)},ClassType.prototype.getClassChildren=function(a){if(a!==!0)return this._children;for(var b={},c=0;c<this._children.length;c++){var d=this._children[c],e=this.getClassManager().get(this._children[c]).getType();b.hasOwnProperty(e)||(b[e]=[]),b[e].push(d)}return this.getEvent("onGetClassChildren").trigger(b),b},ClassType.prototype.getClassParents=function(a){function b(a,b){a.indexOf(b)<0&&a.push(b)}var c=[];if(a!==!0&&(a=!1),a&&(c={}),arguments[1]&&(c=arguments[1]),this.hasParent()){var d=this.getParent(),e=d.getName();if(a){var f=d.getType();c.hasOwnProperty(f)||(c[f]=[]),b(c[f],e)}else b(c,e);c=d.getClassParents(a,c)}return this.getEvent("onGetClassParents").trigger(c,a),c},ClassType.prototype.setParent=function(a){a==this.getName()&&$.Tools.create("Trying to set class as the parent for itself."),"string"==typeof a?(this._parent=this.getClassManager().get(a),this._parent.addChildClass(this.getName())):null===a?(this.hasParent()&&this._parent.removeChildClass(this.getName()),this._parent=null):$.Error.create("InvalidArgument").argument("the name of parent class",!1).received(a).expected('a name of parent class or null in class "'+this.getName()+'"').apply(),this.getEvent("onSetParent").trigger(a)},ClassType.prototype.getParent=function(){return this._parent},ClassType.prototype.hasParent=function(){return!!this._parent},ClassType.prototype.setConstants=function(a){a&&$.Tools.isPlainObject(a)||$.Error.create("InvalidArgument").argument("the constants definition",!1).expected("a plain object").received(a).apply();for(var b in a)a.hasOwnProperty(b)&&this.setConstant(b,a[b])},ClassType.prototype.setConstant=function(a,b){a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of constant",!1).expected("a string").received(a).apply(),this._constants.push(a),Object.defineProperty(this,a,{enumerable:!0,configurable:!1,writable:!1,value:b}),this.getEvent("onSetConstant").trigger(a,b)},ClassType.prototype.getConstants=function(){for(var a=this._constants,b={},c=0;c<a.length;c++)b[a[c]]=this[a[c]];return b},ClassType.prototype.getConstructorEmpty=function(){$.Error.create("NotImplementedMethod").method("getConstructorEmpty").apply()},ClassType.prototype.getConstructor=function(){return this.isConstructorCreated()||this.createConstructor(),this._constructor},ClassType.prototype.isConstructorCreated=function(){return!!this._constructor},ClassType.prototype.createConstructor=function(){if(this.isConstructorCreated())return this._constructor;var a=this.getDefinition(),b=a.getBaseData();a.normalizeData(),this.getEvent("onCreateClassBefore").trigger(a),a.setData($.Tools.extend(b,a.getData())),a.validateData(),a.processData();var c=this.getConstructorEmpty(),d=this.getParent();if(d){var e=d.getConstructor(),f=Object.create(e.prototype);$.Tools.extend(f,c.prototype),c.prototype=f}return this.getEvent("onCreateClass").trigger(c),$.Tools.extend(c.prototype,this.getDefinition().getMethods()),$.Tools.extend(c.prototype,this.getDefinition().getMetaData()),Object.defineProperty(c.prototype,"constructor",{enumerable:!1,configurable:!0,value:c}),c.prototype.$_className=this.getName(),c.prototype.$_classType=this.constructor.getClassTypeName(),c.prototype.$_class=this,this._constructor=c,this.getEvent("onCreateClassAfter").trigger(c),c},ClassType.prototype.createInstance=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);var c=this.getConstructor(),d=new c;this.getEvent("onCreateInstanceBefore").trigger(d);var e=this.getDefinition().getNoMethods(!0);for(var f in e)e.hasOwnProperty(f)&&(d[f]=$.Tools.copy(e[f]));return this.getEvent("onCreateInstance").trigger(d),Object.seal(d),d.$_constructor&&d.$_constructor.apply(d,a),this.setInstanceCreated(),this.getEvent("onCreateInstanceAfter").trigger(d),d},ClassType.prototype.setInstanceCreated=function(){for(var a=this.getClassManager(),b=this.getClassParents(),c=0;c<b.length;c++)a.get(b[c]).setInstanceCreated();this._created=!0},ClassType.prototype.wasInstanceCreated=function(){return this._created?!0:this.hasParent()?this.getParent().wasInstanceCreated():!1},ClassType.prototype.isInstanceOf=function(a){return(!a||"string"!=typeof a&&"object"!=typeof a||"object"==typeof a&&!(a instanceof $.Class.ClassType))&&$.Error.create("InvalidArgument").argument("the name of class",!1).received(a).expected("a string or an instance of Subclass.Class.ClassType").apply(),"object"==typeof a&&(a=a.getName()),this.getName()==a?!0:this.getClassParents().indexOf(a)>=0},ClassType}(),$.Class.ClassDefinition=function(){function a(a,b){a&&a instanceof $.Class.ClassType||$.Error.create("InvalidArgument").argument("the class instance",!1).received(a).expected('an instance of "Subclass.Class.ClassType"').apply(),b&&"object"==typeof b||$.Error.create("InvalidArgument").argument("the definition of class",!1).received(b).expected("a plain object").apply(),this._class=a,this._data=b,this._events={},this.registerEvent("onInitialize").registerEvent("onGetBaseData").registerEvent("onProcessRelatedClasses").registerEvent("onNormalizeData").registerEvent("onValidateData").registerEvent("onProcessData").registerEvent("onGetNoMethods").registerEvent("onGetMethods").registerEvent("onGetMetaData"),this.initialize()}return a.$parent=$.Extendable,a.$mixins=[$.Event.EventableMixin],a.prototype.initialize=function(){this.initializeExtensions(),this.getEvent("onInitialize").trigger()},a.prototype.getData=function(){return this._data},a.prototype.setData=function(a){a&&"object"==typeof a||$.Error.create("InvalidArgument").argument("the definition data",!1).received(a).expected("a plain object").apply(),this._data=a},a.prototype.getClass=function(){return this._class},a.prototype.validateRequires=function(a){if(a&&"object"!=typeof a&&$.Error.create("InvalidClassOption").option("$_requires").received(a).className(this.getClass().getName()).expected("a plain object with string properties").apply(),a)if(Array.isArray(a))for(var b=0;b<a.length;b++)"string"!=typeof a[b]&&$.Error.create("InvalidClassOption").option("$_requires").received(a).className(this.getClass().getName()).expected("a plain object with string properties").apply();else for(var c in a)a.hasOwnProperty(c)&&(c[0].match(/[a-z$_]/i)||$.Error.create('Invalid alias name for required class "'+a[c]+'" in class "'+this.getClass().getName()+'".'),"string"!=typeof a[c]&&$.Error.create("InvalidClassOption").option("$_requires").received(a).className(this.getClass().getName()).expected("a plain object with string properties").apply());return!0},a.prototype.setRequires=function(a){this.validateRequires(a),this.getData().$_requires=a||null},a.prototype.getRequires=function(){return this.getData().$_requires},a.prototype.validateExtends=function(a){return null!==a&&"string"!=typeof a&&$.Error.create("InvalidClassOption").option("$_extends").received(a).className(this.getClass().getName()).expected("a string or null").apply(),!0},a.prototype.setExtends=function(a){this.validateExtends(a),this.getData().$_extends=a,a&&this.getClass().setParent(a)},a.prototype.getExtends=function(){return this.getData().$_extends},a.prototype.validateConstants=function(a){if(null===a||$.Tools.isPlainObject(a)){if(a)for(var b in a)a.hasOwnProperty(b)&&"function"==typeof a[b]&&$.Error.create("InvalidClassOption").option("$_constants").className(this.getClass().getName()).expected("a plain object with not function values").apply()}else $.Error.create("InvalidClassOption").option("$_constants").className(this.getClass().getName()).received(a).expected("a plain object with not function values").apply()},a.prototype.setConstants=function(a){this.validateConstants(a),this._constants=a,a&&this.getClass().setConstants(a)},a.prototype.getConstants=function(){return this._constants},a.prototype.getMetaData=function(a){var b=this._getDataPart("metaData",a);return this.getEvent("onGetMetaData").trigger(b),b},a.prototype.getMethods=function(a){var b=this._getDataPart("methods",a);return this.getEvent("onGetMethods").trigger(b),b},a.prototype.getMethodClass=function(a){var b=this.getData();return b.hasOwnProperty(a)?this.getClass():this.getClass().hasParent()?this.getClass().getParent().getDefinition().getMethodClass(a):null},a.prototype.getMethod=function(a){return this.issetMethod(a)||$.Error.create('Trying to get non existent method "'+a+'" from definition of class "'+this.getClass().getName()+'".'),this.getMethods(!0)[a]},a.prototype.issetMethod=function(a){return this.getMethods(!0).hasOwnProperty(a)},a.prototype.getNoMethods=function(a){var b=this._getDataPart("noMethods",a);return this.getEvent("onGetNoMethods").trigger(b),b},a.prototype._getDataPart=function(a,b){["noMethods","methods","metaData"].indexOf(a)<0&&$.Error.create('Trying to get not existent class definition part data "'+a+'".'),b!==!0&&(b=!1);var c=this.getData(),d=this.getClass(),e={};if(d.hasParent()&&b){var f=d.getParent(),g=f.getDefinition();e=g._getDataPart(a,b)}for(var h in c)!c.hasOwnProperty(h)||"noMethods"==a&&("function"==typeof c[h]||h.match(/^\$_/i))||"methods"==a&&("function"!=typeof c[h]||h.match(/^\$_/i))||"metaData"==a&&!h.match(/^\$_/i)||(e[h]=c[h]);return e},a.prototype.createBaseData=function(){return{$_requires:null,$_extends:null,$_constants:null,getClassManager:function(){return this.$_class.getClassManager()},getClass:function(){return this.$_class},getClassName:function(){return this.$_className},getClassType:function(){return this.$_classType},isInstanceOf:function(a){return this.$_class.isInstanceOf(a)},getParent:function(){return this.$_class.hasParent()?this.$_class.getParent():null},callParent:function(a){var b=this[a];b&&"function"==typeof b||$.Error.create('Trying to call to non existent method "'+a+'" in class "'+this.getClass().getName()+'"');var c=this.getParent().getDefinition().getMethodClass(a);c||$.Error.create('Trying to call parent method "'+a+'" in class "'+this.getClass().getName()+"\" which hasn't parent"),b==c.getDefinition().getData()[a]&&(c=c.getParent());for(var d=[],e=1;e<arguments.length;e++)d.push(arguments[e]);return c.getDefinition().getData()[a].apply(this,d)},getCopy:function(){for(var a=new this.constructor,b=Object.getOwnPropertyNames(this),c=0;c<b.length;c++)a[b[c]]=this[b[c]];return a}}},a.prototype.getBaseData=function(){var a=this.createBaseData();return a.$_className=null,a.$_classType=null,a.$_class=null,this.getEvent("onGetBaseData").trigger(a),a},a.prototype.normalizeData=function(){this.getEvent("onNormalizeData").trigger(this.getData())},a.prototype.validateData=function(){return this.getEvent("onValidateData").trigger(this.getData()),!0},a.prototype.processData=function(){var a=this.getData();for(var b in a)if(a.hasOwnProperty(b)&&b.match(/^\$_/i)){var c="set"+b.substr(2)[0].toUpperCase()+b.substr(3);this[c]&&this[c](a[b])}this.getEvent("onProcessData").trigger(a)},a.prototype.processRelatedClasses=function(){var a=this.getClass(),b=a.getClassManager(),c=this.getRequires(),d=this.getExtends();if(c&&this.validateRequires(c))if($.Tools.isPlainObject(c))for(var e in c)c.hasOwnProperty(e)&&b.load(c[e]);else if(Array.isArray(c))for(var f=0;f<c.length;f++)b.load(c[f]);d&&this.validateExtends(d)&&b.load(d),this.getEvent("onProcessRelatedClasses").trigger()},a}(),$.Class.ClassLoader=function(){function a(a){a&&a instanceof $.ClassManager||$.Error.create("InvalidArgument").argument("the class manager instance",!1).received(a).expected("an instance of Subclass.ClassManager class").apply(),this._classManager=a;var b=a.getModule().getEventManager(),c=a.getModule().getLoadManager();b.getEvent("onAddToLoadStack").addListener(function(b,d){var e=d.replace(/\.js$/,"");a.isset(e)&&c.removeFromStack(d)}),b.getEvent("onProcessLoadStack").addListener(function(b,d){for(var e=0;e<d.length;e++){var f=d[e].file,g=f.replace(/\.js$/,"");a.isset(g)&&c.removeFromStack(f)}})}return a.prototype.getClassManager=function(){return this._classManager},a.prototype.getLoadManager=function(){return this.getClassManager().getModule().getLoadManager()},a.prototype.loadClass=function(a,b){var c=this.getClassManager(),d=this.getLoadManager(),e=a+".js";c.isset(a)||(b&&"function"!=typeof b&&$.Error.create("InvalidArgument").argument("the callback",!1).received(b).expected("a function").apply(),d.loadFile(e,function(){return c.isset(a)||$.Error.create('The class "'+a+'" was not loaded.'),b?b():void 0}))},a.prototype.setClassLoaded=function(a){var b=this.getLoadManager(),c=a+".js";b.removeFromStack(c),b.isStackEmpty()&&b.completeLoading()},a}(),$.Class.ClassBuilder=function(){function a(a,b,c){a&&a instanceof $.ClassManager||$.Error.create("InvalidArgument").argument("the instance of class manager",!1).received(a).expected('an instance of class "Subclass.ClassManager"').apply(),this._classManager=a,this._class=null,this._type=b,this._name=c,this._definition={},this._events=[],this.registerEvent("onInitialize").registerEvent("onSetClass").registerEvent("onPrepareBody").registerEvent("onValidateBefore").registerEvent("onValidateAfter").registerEvent("onCreateBefore").registerEvent("onCreateAfter").registerEvent("onSaveBefore").registerEvent("onSaveAfter").registerEvent("onSaveAsBefore").registerEvent("onSaveAsAfter"),this.initialize()}return a.$parent=$.Extendable,a.$mixins=[$.Event.EventableMixin],a.prototype.initialize=function(){this.initializeExtensions(),this.getEvent("onInitialize").trigger(),this.getName()&&this.getClassManager().isset(this.getName())&&this._setClass(this.getName())},a.prototype.getClassManager=function(){return this._classManager},a.prototype._setClass=function(a){var b=this.getClassManager().get(a),c=b.getDefinition().getData();return b.wasInstanceCreated()&&$.Error.create("Can't alter class \""+a+'". The one or more instances of this class was already created or was created one or more instance of class for which inherits from current one.'),this.setName(b.getName()),this._setType(b.constructor.getClassTypeName()),this._class=b,this._setDefinition($.Tools.copy(c)),this.getEvent("onSetClass").trigger(a),this},a.prototype._setDefinition=function(a){return a&&$.Tools.isPlainObject(a)||$.Error.create("InvalidArgument").argument("the definition of class",!1).received(a).expected("a plain object").apply(),this._definition=a,this},a.prototype.getDefinition=function(){return this._definition},a.prototype._setType=function(a){return"string"!=typeof a&&$.Error.create("InvalidArgument").argument("the type of class",!1).received(a).expected("a string").apply(),this._class&&$.Error.create("Can't redefine class type of already registered class."),this._type=a,this},a.prototype.getType=function(){return this._type},a.prototype.setName=function(a){return this._class&&$.Error.create("Can't redefine class name of already registered class."),this._name=a,this},a.prototype.getName=function(){return this._name},a.prototype.setParent=function(a){return this.getDefinition().$_extends=a,this},a.prototype.getParent=function(){return this.getDefinition().$_extends||null},a.prototype.removeParent=function(){return delete this.getDefinition().$_extends,this},a.prototype.setConstants=function(a){return a&&$.Tools.isPlainObject(a)||$.Error.create("InvalidArgument").argument("the constants definition",!1).received(a).expected("a plain object").apply(),this.getDefinition().$_constants=a,this},a.prototype.getConstants=function(){return this.getDefinition().$_constants||{}},a.prototype.setConstant=function(a,b){return"string"!=typeof a&&$.Error.create("InvalidArgument").argument("the name of constant",!1).received(a).expected("a string").apply(),this.getDefinition().$_constants[a]=b,this},a.prototype.removeConstant=function(a){return"string"!=typeof a&&$.Error.create("InvalidArgument").argument("the name of constant",!1).received(a).expected("a string").apply(),delete this.getDefinition().$_constants[a],this},a.prototype._prepareBody=function(a){a&&"object"==typeof a||$.Error.create("InvalidArgument").argument("the class body",!1).received(a).expected("a plain object").apply();for(var b in a)a.hasOwnProperty(b)&&b.match(/^\$_/i)&&delete a[b];return this.getEvent("onPrepareBody").trigger(a),a},a.prototype.addBody=function(a){a=this._prepareBody(a);var b=this.getDefinition();return $.Tools.extend(b,a),this},a.prototype.setBody=function(a){a=this._prepareBody(a);var b=this.getDefinition();for(var c in b)b.hasOwnProperty(c)&&(c.match(/^$_/)||delete b[c]);return $.Tools.extend(b,a),this},a.prototype.setConstructor=function(a){return this.getDefinition().$_constructor=a,this},a.prototype.getConstructor=function(){return this.getDefinition().$_constructor||null},a.prototype.removeConstructor=function(){var a=this.getDefinition();return delete a.$_constructor,this},a.prototype._validate=function(){return this.getEvent("onValidateBefore").trigger(),this.getType()||$.Error.create("The type of the future class must be specified."),this.getEvent("onValidateAfter").trigger(),this},a.prototype.create=function(){if(this._validate(),this.getEvent("onCreateBefore").trigger(),this._class)return this._class.setDefinition(this.getDefinition()),this._class;var a=$.ClassManager.getType(this.getType()),b=this.getClassManager().create(a,this.getName()||"AnonymousClass_"+String(Math.round(Math.random()*(new Date).valueOf()/1e5)),this.getDefinition());return this.getEvent("onCreateAfter").trigger(b),b},a.prototype.save=function(){if(this.getName()||$.Error.create("The future class must be named."),this._validate(),this.getEvent("onSaveBefore").trigger(),this._class)return this._class.setDefinition(this.getDefinition()),this._class;var a=this.getClassManager().add(this.getType(),this.getName(),this.getDefinition());return a.getConstructor(),this.getEvent("onSaveAfter").trigger(a),a},a.prototype.saveAs=function(a){this.getName()||$.Error.create("The future class must be named."),this._validate(),this.getEvent("onSaveAsBefore").trigger();var b=this.getClassManager().add(this.getType(),a,this.getDefinition());return b.getConstructor(),this.getEvent("onSaveAsAfter").trigger(b),b},a}(),$.Class.ClassExtension=function(){function a(){a.$parent.call(this)}return a.$parent=$.Extension,a.$config={classes:[]},a}(),$.Class.Type.Class={},$.Class.Type.Class.Class=function(){function Class(){Class.$parent.apply(this,arguments),this._abstractMethods={},this._static=[],this._staticContext=null}return Class.$parent=$.Class.ClassType,Class.getClassTypeName=function(){return"Class"},Class.getBuilderClass=function(){return $.Class.Type.Class.ClassBuilder},Class.getDefinitionClass=function(){return $.Class.Type.Class.ClassDefinition},Class.prototype.getConstructorEmpty=function(){return function Class(){return Class.name}},Class.prototype.createConstructor=function(){var a=Class.$parent.prototype.createConstructor.call(this),b=this._abstractMethods=this.getAbstractMethods(),c=[];if(this.hasParent()){var d=this.getParent();
d.getAbstractMethods&&this.extendAbstractMethods(d),d.getStaticProperties&&this.extendStaticProperties(d)}if(this.constructor!=$.Class.Type.AbstractClass.AbstractClass){for(var e in b)b.hasOwnProperty(e)&&(a.prototype[e]&&"function"==typeof a.prototype[e]||c.push(e));c.length&&$.Error.create('The class "'+this.getName()+'" must be an abstract or implement abstract methods: "'+c.join('", "')+'".')}return a},Class.prototype.setParent=function(a){Class.$parent.prototype.setParent.call(this,a),this._parent&&this._parent.constructor!=Class&&this._parent.constructor!=$.ClassManager.getType("AbstractClass")&&$.Error.create('The class "'+this.getName()+'" can be inherited only from another class or abstract class.'),this._parent&&this._parent.constructor==Class&&this._parent.getDefinition().isFinal()&&$.Error.create('The class "'+this.getName()+'" can\'t extend the final class "'+this._parent.getName()+'"')},Class.prototype.getStaticContext=function(){var a=this;return this._staticContext||(this._staticContext={getClass:function(){return a},getParent:function(){return a.getParent()}}),this._staticContext},Class.prototype.addStaticProperties=function(a){a&&$.Tools.isPlainObject(a)||$.Error.create("InvalidArgument").argument("the static properties definition",!1).expected("a plain object").received(a).apply();for(var b in a)a.hasOwnProperty(b)&&this.addStaticProperty(b,a[b])},Class.prototype.addStaticProperty=function(a,b){a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of static property",!1).expected("a string").received(a).apply();var c=this.getStaticContext();c[a]=b,this._static.push(a),"function"==typeof b?(this[a]=function(){return c[a].apply(c,arguments)},this[a].origin=b):Object.defineProperty(this,a,{configurable:!0,enumerable:!0,set:function(b){c[a]=b},get:function(){return c[a]}})},Class.prototype.extendStaticProperties=function(a){for(var b,c,d=$.Tools.copy(this.getStaticPropertyNames()),e=$.Tools.copy(this.getStaticContext()),f=a.getStaticContext(),g=a.getStaticPropertyNames(),h=0;h<g.length;h++)b=g[h],c=f[b],this.addStaticProperty(b,c);for(h=0;h<d.length;h++)b=d[h],c=e[b],this.addStaticProperty(b,c)},Class.prototype.getStaticProperties=function(){for(var a=this._static,b={},c=0;c<a.length;c++)b[a[c]]=this[a]},Class.prototype.getStaticPropertyNames=function(){return this._static},Class.prototype.getAbstractMethods=function(){return this._abstractMethods},Class.prototype.addAbstractMethods=function(a){$.Tools.extend(this._abstractMethods,a)},Class.prototype.extendAbstractMethods=function(a){$.Tools.extend(this.getAbstractMethods(),a.getAbstractMethods())},$.ClassManager.registerType(Class),Class}(),$.Class.Type.Class.ClassBuilder=function(){function a(b,c,d){a.$parent.call(this,b,c,d)}return a.$parent=$.Class.ClassBuilder,a.prototype.setFinal=function(a){return"boolean"!=typeof a&&$.Error.create("InvalidArgument").argument("is final option value",!1).expected("a boolean").received(a).apply(),this.getDefinition().$_final=a,this},a.prototype.getFinal=function(){return this.getDefinition().$_final},a.prototype.setStaticProperties=function(a){return a&&$.Tools.isPlainObject(a)||$.Error.create("InvalidArgument").argument("the static properties",!1).received(a).expected("a plain object").apply(),this.getDefinition().$_static=a,this},a.prototype.getStaticProperties=function(){return this.getDefinition().$_static||{}},a.prototype.setStaticProperty=function(a,b){return"string"!=typeof a&&$.Error.create("InvalidArgument").argument("the name of static property",!1).received(a).expected("a string").apply(),this.getDefinition().$_static[a]=b,this},a.prototype.removeStaticProperty=function(a){return"string"!=typeof a&&$.Error.create("InvalidArgument").argument("the name of static property",!1).received(a).expected("a string").apply(),delete this.getDefinition().$_static[a],this},a}(),$.Class.Type.Class.ClassDefinition=function(){function a(b,c){a.$parent.call(this,b,c)}return a.$parent=$.Class.ClassDefinition,a.prototype.validateFinal=function(a){return"boolean"!=typeof a&&$.Error.create("InvalidClassOption").option("$_final").received(a).className(this.getClass().getName()).expected("a boolean").apply(),!0},a.prototype.setFinal=function(a){this.validateFinal(a),this.getData().$_final=a},a.prototype.getFinal=function(){return this.getData().$_final},a.prototype.isFinal=function(){return this.getFinal()},a.prototype.validateStatic=function(a){return null===a||$.Tools.isPlainObject(a)||$.Error.create("InvalidClassOption").option("$_static").className(this.getClass().getName()).received(a).expected("a plain object or null").apply(),!0},a.prototype.setStatic=function(a){this.validateStatic(a),this.getData().$_static=a||{},a&&this.getClass().addStaticProperties(a)},a.prototype.getStatic=function(){return this.getData().$_static},a.prototype.createBaseData=function(){var b=a.$parent.prototype.createBaseData();return b.$_final=!1,b.$_static={},b},a}(),$.Class.Type.AbstractClass={},$.Class.Type.AbstractClass.Extension={},$.Class.Type.AbstractClass.AbstractClass=function(){function AbstractClass(a,b,c){AbstractClass.$parent.call(this,a,b,c)}return AbstractClass.$parent=$.Class.Type.Class.Class,AbstractClass.getClassTypeName=function(){return"AbstractClass"},AbstractClass.getBuilderClass=function(){return $.Class.Type.AbstractClass.AbstractClassBuilder},AbstractClass.getDefinitionClass=function(){return $.Class.Type.AbstractClass.AbstractClassDefinition},AbstractClass.prototype.setParent=function(a){$.Class.ClassType.prototype.setParent.call(this,a),!this._parent||this._parent.constructor==AbstractClass||this._parent instanceof AbstractClass||$.Error.create('The abstract class "'+this.getName()+'" can be inherited only from the another abstract class.')},AbstractClass.prototype.getConstructorEmpty=function(){return function AbstractClass(){return AbstractClass.name}},AbstractClass.prototype.createInstance=void 0,$.ClassManager.registerType(AbstractClass),AbstractClass}(),$.Class.Type.AbstractClass.AbstractClassBuilder=function(){function a(b,c,d){a.$parent.call(this,b,c,d)}return a.$parent=$.Class.Type.Class.ClassBuilder,a.prototype.setFinal=void 0,a.prototype.getFinal=void 0,a.prototype._validateAbstractMethods=function(a){$.Tools.isPlainObject(a)||$.Error.create("InvalidArgument").argument("the list of abstract methods",!1).received(a).expected("a plain object with functions").apply();for(var b in a)a.hasOwnProperty(b)&&this._validateAbstractMethod(a[b])},a.prototype._validateAbstractMethod=function(a){"function"!=typeof a&&$.Error.create("InvalidArgument").argument("the name of abstract method",!1).received(a).expected("a function").apply()},a.prototype.setAbstractMethods=function(a){return this._validateAbstractMethods(a),this.getDefinition().$_abstract=a,this},a.prototype.addAbstractMethods=function(a){return this._validateAbstractMethods(a),this.getDefinition().$_abstract||(this.getDefinition().$_abstract={}),$.Tools.extend(this.getDefinition().$_abstract,a),this},a.prototype.addAbstractMethod=function(a,b){return this._validateAbstractMethod(b),a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of abstract method",!1).received(a).expected("a string").apply(),this.getDefinition().$_abstract||(this.getDefinition().$_abstract={}),this.getDefinition().$_abstract[a]=b,this},a.prototype.getAbstractMethods=function(){return this.getDefinition().$_abstract||{}},a.prototype.removeAbstractMethod=function(a){var b=this.getAbstractMethods();return delete b[a],this},a}(),$.Class.Type.AbstractClass.AbstractClassDefinition=function(){function a(b,c){a.$parent.call(this,b,c)}return a.$parent=$.Class.Type.Class.ClassDefinition,a.prototype.validateFinal=function(){$.Error.create("Abstract class definition cannot contain $_final option and consequently can't be final.")},a.prototype.validateAbstract=function(a){try{if(null!==a&&!$.Tools.isPlainObject(a))throw"error";if(a)for(var b in a)if(a.hasOwnProperty(b)&&"function"!=typeof a[b])throw"error"}catch(c){if("error"!=c)throw c;$.Error.create("InvalidClassOption").option("$_abstract").className(this.getClass().getName()).expected("a plain object with methods or a null").received(a).apply()}return!0},a.prototype.setAbstract=function(a){this.validateAbstract(a),this.getData().$_abstract=a||{},a&&this.getClass().addAbstractMethods(a)},a.prototype.getAbstract=function(){return this.getData().$_abstract},a.prototype.createBaseData=function(){return{$_requires:null,$_extends:null,$_constants:null,$_abstract:{}}},a}(),$.Class.Type.AbstractClass.Extension.ClassDefinitionExtension=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=$.Extension,$.Module.onInitializeBefore(function(){if($.ClassManager.issetType("Interface")){var a=$.Class.Type.Interface.Extension.ClassDefinitionExtension;a=$.Tools.buildClassConstructor(a),a.getConfig().classes.push("AbstractClass")}if($.ClassManager.issetType("Trait")){var b=$.Class.Type.Trait.Extension.ClassDefinitionExtension;b=$.Tools.buildClassConstructor(b),b.getConfig().classes.push("AbstractClass")}}),a}(),$.Class.Type.AbstractClass.Extension.ClassExtension=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=$.Extension,$.Module.onInitializeBefore(function(){if($.ClassManager.issetType("Interface")){var a=$.Class.Type.Interface.Extension.ClassExtension;a=$.Tools.buildClassConstructor(a),a.getConfig().classes.push("AbstractClass")}if($.ClassManager.issetType("Trait")){var b=$.Class.Type.Trait.Extension.ClassExtension;b=$.Tools.buildClassConstructor(b),b.getConfig().classes.push("AbstractClass")}}),a}(),$.Class.Type.Interface={},$.Class.Type.Interface.Extension={},$.Class.Type.Interface.Interface=function(){function Interface(a,b,c){Interface.$parent.call(this,a,b,c)}return Interface.$parent=$.Class.ClassType,Interface.getClassTypeName=function(){return"Interface"},Interface.getBuilderClass=function(){return $.Class.Type.Interface.InterfaceBuilder},Interface.getDefinitionClass=function(){return $.Class.Type.Interface.InterfaceDefinition},Interface.prototype.setParent=function(a){Interface.$parent.prototype.setParent.call(this,a),!this._parent||this._parent.constructor==Interface||this._parent instanceof Interface||$.Error.create('Interface "'+this.getName()+'" can be inherited only from the another interface.')},Interface.prototype.getConstructorEmpty=function(){return function Interface(){return Interface.name}},Interface.prototype.createInstance=void 0,$.ClassManager.registerType(Interface),Interface}(),$.Class.Type.Interface.Extension.ClassBuilderExtension=function(){function a(){a.$parent.apply(this,arguments)}a.$parent=$.Extension;var b=$.Class.Type.Class.ClassBuilder;return b.prototype._validateInterfaces=function(a){Array.isArray(a)||$.Error.create("InvalidArgument").argument("the list of interface names",!1).received(a).expected("an array of strings").apply();for(var b=0;b<a.length;b++)this._validateInterface(a[b])},b.prototype._validateInterface=function(a){"string"!=typeof a&&$.Error.create("InvalidArgument").argument("the interface name",!1).received(a).expected("a string").apply()},b.prototype.setInterfaces=function(a){return this._validateInterfaces(a),this.getDefinition().$_implements=a,this},b.prototype.addInterfaces=function(a){return this._validateInterfaces(a),this.getDefinition().$_implements||(this.getDefinition().$_implements=[]),this.getDefinition().$_implements=this.getDefinition().$_implements.concat(a),this},b.prototype.addInterface=function(a){return this._validateInclude(a),this.getDefinition().$_implements||(this.getDefinition().$_implements=[]),this.getDefinition().$_implements.push(a),this},b.prototype.getInterfaces=function(){return this.getDefinition().$_implements||[]},$.Module.onInitializeBefore(function(){b=$.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),$.Class.Type.Interface.Extension.ClassDefinitionExtension=function(){function a(){a.$parent.apply(this,arguments)}a.$parent=$.Class.ClassExtension,a.$config={classes:["Class"]},a.initialize=function(b){var c=this.getConfig().classes;return c.indexOf(b.getClass().getType())<0?!1:(a.$parent.initialize.apply(this,arguments),b.getEvent("onGetBaseData").addListener(function(a,b){b.$_implements=[],b.isImplements=function(a){return this.$_class.isImplements(a)}}),void b.getEvent("onProcessRelatedClasses").addListener(function(){var a=this.getClass(),b=a.getClassManager(),c=this.getImplements();if(c&&this.validateImplements(c))for(var d=0;d<c.length;d++)b.load(c[d])}))};var b=$.Class.Type.Class.ClassDefinition;return b.prototype.validateImplements=function(a){try{if(a&&!Array.isArray(a))throw"error";if(a)for(var b=0;b<a.length;b++)if("string"!=typeof a[b])throw"error"}catch(c){if("error"!=c)throw c;$.Error.create("InvalidClassOption").option("$_implements").className(this.getClass().getName()).received(a).expected("an array of strings").apply()}return!0},b.prototype.setImplements=function(a){this.validateImplements(a),this.getData().$_implements=a||[],a&&this.getClass().addInterfaces(a)},b.prototype.getImplements=function(){return this.getData().$_implements},$.Module.onInitializeBefore(function(){b=$.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),$.Class.Type.Interface.Extension.ClassExtension=function(){function a(){a.$parent.apply(this,arguments)}a.$parent=$.Class.ClassExtension,a.$config={classes:["Class"]},a.initialize=function(b){var c=this.getConfig().classes;return c.indexOf(b.getType())<0?!1:(a.$parent.initialize.apply(this,arguments),b.getEvent("onInitialize").addListener(function(){this._interfaces=[]}),void b.getEvent("onGetClassParents").addListener(function(a,b,c){function d(a,b){a.indexOf(b)<0&&a.push(b)}for(var e=this.getInterfaces(!0),f=0;f<e.length;f++){var g=e[f],h=g.getName();if(c){var i=g.getType();b.hasOwnProperty(i)||(b[i]=[]),d(b[i],h)}else d(b,h)}}))};var Class=$.Class.Type.Class.Class;return Class.prototype.addInterfaces=function(a){a&&Array.isArray(a)||$.Error.create("InvalidArgument").argument("the traits list",!1).expected("an array").received(a).apply();for(var b=0;b<a.length;b++)this.addInterface(a[b])},Class.prototype.addInterface=function(a){a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of interface",!1).received(a).expected("a string").apply();var b=this.getClassManager().get(a);b.addChildClass(this.getName()),b.constructor!=$.Class.Type.Interface.Interface&&$.Error.create("Can't implement no interface \""+a+'" in class "'+this.getName()+'".');var c=b.getConstructor(),d=c.prototype,e={};b.constructor!=$.Class.Type.Interface.Interface&&$.Error.create('Trying add to "$_implements" option the new class "'+a+'" that is not an interface.');for(var f in d)"function"==typeof d[f]&&(e[f]=d[f]);this.addAbstractMethods(e),this.getInterfaces().push(b)},Class.prototype.getInterfaces=function(a){if(a!==!0)return this._interfaces;for(var b=this.getClassManager(),c=$.Tools.copy(this._interfaces),d=0;d<c.length;d++)for(var e=c[d].getClassParents(),f=0;f<e.length;f++)c.push(b.get(e[f]));if(this.hasParent()){var g=this.getParent();g.getInterfaces&&(c=c.concat(g.getInterfaces(a)))}return c},Class.prototype.isImplements=function(a){a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of interface",!1).received(a).expected("a string").apply();for(var b=this.getInterfaces(),c=0;c<b.length;c++)if(b[c].isInstanceOf(a))return!0;if(this.hasParent()){var d=this.getParent();if(d.isImplements)return d.isImplements(a)}return!1},$.Module.onInitializeBefore(function(){Class=$.Tools.buildClassConstructor(Class),Class.hasExtension(a)||Class.registerExtension(a)}),a}(),$.Class.Type.Interface.InterfaceBuilder=function(){function a(b,c,d){a.$parent.call(this,b,c,d)}return a.$parent=$.Class.ClassBuilder,a.prototype.setConstructor=void 0,a.prototype.getConstructor=void 0,a.prototype.removeConstructor=void 0,a}(),$.Class.Type.Interface.InterfaceDefinition=function(){function a(b,c){a.$parent.call(this,b,c)}return a.$parent=$.Class.ClassDefinition,a.prototype.createBaseData=function(){return{$_extends:null,$_constants:null}},a.prototype.normalizeData=function(){a.$parent.prototype.normalizeData.call(this);var b=this.getData(),c=this.getNoMethods();b.hasOwnProperty("$_constants")||(b.$_constants={});for(var d in c)c.hasOwnProperty(d)&&(b.$_constants[d]=c[d],delete b[d])},a}(),$.Class.Type.Trait={},$.Class.Type.Trait.Extension={},$.Class.Type.Trait.Trait=function(){function Trait(a,b,c){Trait.$parent.call(this,a,b,c),delete this._abstractMethods,delete this._created,delete this._traits,$.ClassManager.issetType("Interface")&&(this.addInterfaces=void 0,this.getInterfaces=void 0,this.addInterface=void 0,this.isImplements=void 0)}return Trait.$parent=$.Class.Type.Class.Class,Trait.getClassTypeName=function(){return"Trait"},Trait.getBuilderClass=function(){return $.Class.Type.Trait.TraitBuilder},Trait.getDefinitionClass=function(){return $.Class.Type.Trait.TraitDefinition},Trait.prototype.getConstructorEmpty=function(){return function Trait(){return Trait.name}},Trait.prototype.setParent=function(a){$.Class.ClassType.prototype.setParent.call(this,a),!this._parent||this._parent.constructor==Trait||this._parent instanceof Trait||$.Error.create('The trait "'+this.getName()+'" can be inherited only from the another trait.')},Trait.prototype.createConstructor=function(){return $.Class.ClassType.prototype.createConstructor.apply(this,arguments)},Trait.prototype.getAbstractMethods=void 0,Trait.prototype.addAbstractMethods=void 0,Trait.prototype.createInstance=void 0,$.ClassManager.registerType(Trait),Trait}(),$.Class.Type.Trait.Extension.ClassBuilderExtension=function(){function a(){a.$parent.apply(this,arguments)}a.$parent=$.Extension;var b=$.Class.Type.Class.ClassBuilder;return b.prototype._validateTraits=function(a){Array.isArray(a)||$.Error.create("InvalidArgument").argument("the list of trait names",!1).received(a).expected("an array of strings").apply();for(var b=0;b<a.length;b++)this._validateTrait(a[b])},b.prototype._validateTrait=function(a){"string"!=typeof a&&$.Error.create("InvalidArgument").argument("the trait name",!1).received(a).expected("a string").apply()},b.prototype.setTraits=function(a){return this._validateTraits(a),this.getDefinition().$_traits=a,this},b.prototype.addTraits=function(a){return this._validateTraits(a),this.getDefinition().$_traits||(this.getDefinition().$_traits=[]),this.getDefinition().$_traits=this.getDefinition().$_traits.concat(a),this},b.prototype.addTrait=function(a){return this._validateTrait(a),this.getDefinition().$_traits||(this.getDefinition().$_traits=[]),this.getDefinition().$_traits.push(a),this},b.prototype.getTraits=function(){return this.getDefinition().$_traits||[]},$.Module.onInitializeBefore(function(){b=$.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),$.Class.Type.Trait.Extension.ClassDefinitionExtension=function(){function a(){a.$parent.apply(this,arguments)}a.$parent=$.Class.ClassExtension,a.$config={classes:["Class"]},a.initialize=function(b){var c=this.getConfig().classes;return c.indexOf(b.getClass().getType())<0?!1:(a.$parent.initialize.apply(this,arguments),b.getEvent("onGetBaseData").addListener(function(a,b){b.$_traits=[],b.hasTrait=function(a){return this.$_class.hasTrait(a)}}),void b.getEvent("onProcessRelatedClasses").addListener(function(){var a=this.getClass(),b=a.getClassManager(),c=this.getTraits();if(c&&this.validateTraits(c))for(var d=0;d<c.length;d++)b.load(c[d])}))};var b=$.Class.Type.Class.ClassDefinition;return b.prototype.validateTraits=function(a){try{if(a&&!Array.isArray(a))throw"error";if(a)for(var b=0;b<a.length;b++)if("string"!=typeof a[b])throw"error"}catch(c){if("error"!=c)throw c;$.Error.create("InvalidClassOption").option("$_traits").className(this.getClass().getName()).received(a).expected("an array of strings").apply()}return!0},b.prototype.setTraits=function(a){this.validateTraits(a),this.getData().$_traits=a||[],a&&this.getClass().addTraits(a)},b.prototype.getTraits=function(){return this.getData().$_traits},$.Module.onInitializeBefore(function(){b=$.Tools.buildClassConstructor(b),b.hasExtension(a)||b.registerExtension(a)}),a}(),$.Class.Type.Trait.Extension.ClassExtension=function(){function a(){a.$parent.apply(this,arguments)}a.$parent=$.Class.ClassExtension,a.$config={classes:["Class"]},a.initialize=function(b){var c=this.getConfig().classes;return c.indexOf(b.getType())<0?!1:(a.$parent.initialize.apply(this,arguments),b.registerEvent("onAddTrait"),b.getEvent("onInitialize").addListener(function(){this._traits=[]}),void b.getEvent("onGetClassParents").addListener(function(a,b,c){function d(a,b){a.indexOf(b)<0&&a.push(b)}for(var e=this.getTraits(!0),f=0;f<e.length;f++){var g=e[f],h=g.getName();if(c){var i=g.getType();b.hasOwnProperty(i)||(b[i]=[]),d(b[i],h)}else d(b,h)}}))};var Class=$.Class.Type.Class.Class;return Class.prototype.addTraits=function(a){a&&Array.isArray(a)||$.Error.create("InvalidArgument").argument("the traits list",!1).expected("an array").received(a).apply();for(var b=0;b<a.length;b++)this.addTrait(a[b])},Class.prototype.getTraits=function(a){if(a!==!0)return this._traits;for(var b=this.getClassManager(),c=$.Tools.copy(this._traits),d=0;d<c.length;d++)for(var e=c[d].getClassParents(),f=0;f<e.length;f++)c.push(b.get(e[f]));if(this.hasParent()){var g=this.getParent();g.getTraits&&(c=c.concat(g.getTraits(a)))}return c},Class.prototype.addTrait=function(a){var b=this.getDefinition();a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of trait",!1).received(a).expected("a string").apply();var c=this.getClassManager().get(a),d=c.getDefinition(),e={};c.addChildClass(this.getName()),c.constructor!=$.Class.Type.Trait.Trait&&$.Error.create('Trying add to "$_traits" option the new class "'+a+'" that is not a trait.'),this.getEvent("onAddTrait").trigger(c),this.extendStaticProperties(c),this.getTraits().push(c),$.Tools.extend(e,d.getNoMethods(!0)),$.Tools.extend(e,d.getMethods(!0)),b.setData($.Tools.extend(e,b.getData()))},Class.prototype.hasTrait=function(a){a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("the name of trait",!1).received(a).expected("a string").apply();for(var b=this.getTraits(),c=0;c<b.length;c++)if(b[c].isInstanceOf(a))return!0;if(this.hasParent()){var d=this.getParent();if(d.hasTrait)return d.hasTrait(a)}return!1},$.Module.onInitializeBefore(function(){Class=$.Tools.buildClassConstructor(Class),Class.hasExtension(a)||Class.registerExtension(a)}),a}(),$.Class.Type.Trait.TraitBuilder=function(){function a(b,c,d){a.$parent.call(this,b,c,d)}return a.$parent=$.Class.ClassBuilder,a.prototype.setFinal=void 0,a.prototype.getFinal=void 0,a.prototype.setStatic=void 0,a.prototype.getStatic=void 0,a.prototype.setStaticProperty=void 0,a.prototype.removeStaticProperty=void 0,a}(),$.Class.Type.Trait.TraitDefinition=function(){function a(){a.$parent.apply(this,arguments)}return a.$parent=$.Class.Type.Class.ClassDefinition,a.prototype.validateFinal=function(){$.Error.create("Trait class definition cannot contain $_final option and consequently can't be final.")},a.prototype.createBaseData=function(){return{$_extends:null}},a}(),$.ClassManager.register("Interface","Subclass/Event/EventableInterface",{registerEvent:function(){},triggerEvent:function(){},addEventListener:function(){},removeEventListener:function(){}}),$.ClassManager.register("Trait","Subclass/Event/EventableTrait",{_events:{},getEvents:function(){return this._events},registerEvent:function(a){return a&&"string"==typeof a||$.Error.create("InvalidArgument").argument("name of event",!1).received(a).expected("a string").apply(),this.getEvents()[a]=[],this},triggerEvent:function(a){this.getEvents().hasOwnProperty(a)||$.Error.create('There is not event named "'+a+'".');for(var b="_passed_"+Math.round((new Date).getTime()*Math.random()),c=this.getEvents()[a],d=[],e=[],f=this,g=1;g<arguments.length;g++)d.push(arguments[g]);for(g=0;g<c.length;g++){var h=c[g];e.push(h.priority),h.hash[b]=!1}for(e=e.sort(function(a,b){return a=parseInt(a),b=parseInt(b),a>b?-1:b>a?1:0}),g=0;g<e.length;g++)for(var i=0;i<c.length;i++)if(h=c[i],!h.hash[b]&&h.priority==e[g]&&(h.hash[b]=!0,h.callback.apply(f,d)===!1))return!1;for(g=0;g<c.length;g++)delete c[g].hash[b];return this},addEventListener:function(a,b,c){"function"==typeof b&&(c=b,b=null),c&&"function"==typeof c||$.Error.create("InvalidArgument").argument('the listener in event "'+a+'"',!1).received(c).expected("a function").apply(),this.getEvents().hasOwnProperty(a)||$.Error.create('There is not event named "'+a+'".'),b||"number"==typeof b||(b=this.getEvents()[a].length);var d={priority:b,callback:c,hash:{}};return this.getEvents()[a].push(d),this},removeEventListener:function(a,b){var c=this.getEvents();for(var d in c)if(c.hasOwnProperty(d)){for(var e,f=c[d],g=0;g<f.length;g++)if(f[g].callback==b){e=g;break}if(e){f.splice(e,1);break}}return this}}),$.EventManager=function(){function a(a){a&&a instanceof $.Module||$.Error.create("InvalidArgument").argument("the module instance",!1).received(a).expected('the instance of class "Subclass.Module"').apply(),this._module=a}return a.$mixins=[$.Event.EventableMixin],a.prototype.getModule=function(){return this._module},a.prototype.getEvents=function(a){var b=this.getModule(),c=b.getModuleStorage(),d={},e=this;return a!==!0&&(a=!1),a?this._events:(c.eachModule(!0,function(a){if(a==b)return void $.Tools.extend(d,e._events);var c=a.getEventManager(),f=c.getEvents();$.Tools.extend(d,f)}),d)},a.prototype.registerEvent=function(a){return this.issetEvent(a,!0)?this:(this._events[a]=$.Tools.createClassInstance($.ModuleEvent,this,a,this.getModule()),this)},a.prototype.issetEvent=function(a,b){return!!this.getEvents(b)[a]},a}(),$.LoadManager=function(){function a(a){a&&a instanceof $.Module||$.Error.create("InvalidError").argument("the module instance",!1).received(a).expected("an instance of Subclass.Module class").apply(),this._module=a,this._stack=[],this._stackPortion=[],this._loading=!1,this._loadingPause=!1,this._loadingEndTimeout=null,this._addToStackTimeout=null,a.getEventManager().registerEvent("onLoadingStart").registerEvent("onLoadingEnd").registerEvent("onAddToLoadStack").registerEvent("onRemoveFromLoadStack").registerEvent("onProcessLoadStack")}return a.prototype.initialize=function(){var a=this.getModule(),b=a.getEventManager(),c=this;b.getEvent("onLoadingEnd").addListener(-1e7,function(){a.getModuleStorage().eachModule(function(a){a!=c.getModule()&&a.getLoadManager().startLoading()})})},a.prototype.getModule=function(){return this._module},a.prototype.startLoading=function(){var a=this.getModule(),b=this;(!a.isPlugin()||a.getParent()&&a.getRoot().isPrepared())&&(b._loading=!0,b._loadingPause=!1,b.processStack(),b.getModule().getEventManager().getEvent("onLoadingStart").trigger(),b.isStackEmpty()&&b.completeLoading())},a.prototype.pauseLoading=function(){clearTimeout(this._loadingEndTimeout),this._loadingPause=!0},a.prototype.isLoadingPaused=function(){return this._loadingPause},a.prototype.completeLoading=function(){if(this.isLoading()){clearTimeout(this._loadingEndTimeout);var a=this;!this.isLoadingPaused()&&this.isStackEmpty()&&(this._loadingEndTimeout=setTimeout(function(){var b=a.getModule(),c=b.getEventManager();a._loading=!1,c.getEvent("onLoadingEnd").triggerPrivate()},20))}},a.prototype.isLoading=function(){return this._loading},a.prototype.addToStack=function(a,b){var c=this;b&&"function"!=typeof b&&$.Error.create("InvalidArgument").argument("the callback",!1).received(b).expected("a function").apply(),this.isInStack(a)||(this._stack.push({file:a,fileFull:null,callback:b||function(){},xmlhttp:null}),clearTimeout(this._addToStackTimeout),this.getModule().getEventManager().getEvent("onAddToLoadStack").trigger(a,b),this._addToStackTimeout=setTimeout(function(){c.startLoading()},10))},a.prototype.loadFile=a.prototype.addToStack,a.prototype.getStackItem=function(a){for(var b=null,c=0;c<this._stack.length;c++)this._stack[c].file==a&&(b=this._stack[c]);return b},a.prototype.getStackItemIndex=function(a){for(var b=!1,c=0;c<this._stack.length;c++)this._stack[c].file==a&&(b=c);return b},a.prototype.removeFromStack=function(a){var b=this.getModule().getRoot();arguments[1]&&(b=this.getModule());var c=b.getLoadManager(),d=c.getStackItem(a),e=c.getStackItemIndex(a);d&&e!==!1&&(b.getEventManager().getEvent("onRemoveFromLoadStack").trigger(d,e),d.xmlhttp&&d.xmlhttp.abort(),c._stack.splice(e,1));var f=b.getModuleStorage();f.eachModule(function(c){c!=b&&c.getLoadManager().removeFromStack(a,!0)})},a.prototype.processStack=function(){var a=this.getModule(),b=a.getSettingsManager(),c=b.getRootPath(),d=[],e=this;if(this.isStackPortionEmpty()){for(var f=0;f<this._stack.length;f++){var g=this._stack[f];d.push(g.file),g.fileFull=g.file.match(/^\^/i)?g.file.substr(1):c+g.file}this.setStackPortion(d),a.getEventManager().getEvent("onProcessLoadStack").trigger(this._stack),!function h(a){if(a){var b=e.getStackItem(a);b&&(b.xmlhttp=$.Tools.loadJS(b.fileFull,function(){e.removeFromStackPortion(b.file),e.removeFromStack(b.file),b.callback();var a=e.getStackPortion()[0];a?h(a):e.startLoading()}))}}(d[0]),this.isStackEmpty()||this.pauseLoading()}},a.prototype.isInStack=function(a){var b=this.getModule().getRoot();arguments[1]&&(b=this.getModule());for(var c=b.getLoadManager(),d=0;d<c._stack.length;d++)if(c._stack[d].file==a)return!0;var e=b.getModuleStorage(),f=!1;return e.eachModule(function(c){return c!=b&&(f=c.getLoadManager().removeFromStack(a,!0))?!1:void 0}),f},a.prototype.isStackEmpty=function(){return!this._stack.length},a.prototype.setStackPortion=function(a){Array.isArray(a)||$.Error.create("InvalidArgument").argument("list of file names",!1).received(a).expected("array of strings").apply(),this._stackPortion=a},a.prototype.getStackPortion=function(){return this._stackPortion},a.prototype.isStackPortionEmpty=function(){return!this.getStackPortion().length},a.prototype.removeFromStackPortion=function(a){var b=this.getStackPortion(),c=b.indexOf(a);c>=0&&b.splice(c,1)},a}(),$.ModuleEvent=function(){function a(b,c,d){a.$parent.call(this,c,d),b&&b instanceof $.EventManager||$.Error.create("InvalidArgument").argument("the event manager instance",!1).received(b).expected('an instance of "Subclass.EventManager"').apply(),this._eventManager=b}return a.$parent=$.Event.Event,a.prototype.getEventManager=function(){return this._eventManager},a.prototype.getListeners=function(a){var b=this.getEventManager().getModule(),c=b.getModuleStorage(),d=[],e=this;return a!==!0&&(a=!1),a?this._listeners:(c.eachModule(function(a){if(a==b)return void $.Tools.extend(d,e._listeners);var c=a.getEventManager(),f=c.getEvent(e.getName()).getListeners();
$.Tools.extend(d,f)}),$.Tools.unique(d))},a.prototype.getListenerByCallback=function(a){a&&"Function"==typeof a||$.Error.create("InvalidArgument").argument("the callback",!1).received(a).expected("a function").apply();var b=this.getEventManager().getModule(),c=b.getModuleStorage(),d=null,e=this;return c.eachModule(function(b){for(var c=b.getEventManager(),f=c.getEvent(e.getName()),g=f.getListeners(!0),h=0;h<g.length;h++)if(g[h].getCallback()==a)return d=g[h],!1}),d},a.prototype.removeListener=function(a){a&&"Function"==typeof a||$.Error.create("InvalidArgument").argument("the callback",!1).received(a).expected("a function").apply();var b=this.getEventManager().getModule(),c=b.getModuleStorage(),d=this;return c.eachModule(function(b){var c=b.getEventManager(),e=c.getEvent(d.getName()),f=e.getListeners(!0),g=f.indexOf(a);g>=0&&f.splice(g,1)}),this},a.prototype.triggerPrivate=function(){var a=this.getListeners(!0);return this._processTrigger(a,arguments)},a}(),$.ModuleStorage=function(){function a(a,b){a&&a instanceof $.Module||$.Error.create("InvalidArgument").argument("the module instance",!1).received(a).expected('an instance of "Subclass.Module"').apply(),b&&!Array.isArray(b)?$.Error.create("InvalidArgument").argument("the list of plug-in module names",!1).received(b).expected("an array of plug-in module names").apply():b||(b=[]);for(var c={},d=0,e=0;d<b.length;d++,e++)"object"==typeof b[d]&&(c[b[d].name]=e,b.splice(d,1),d--);this._module=a,this._modules=this._processModules(b),this._modules.unshift(a),this._lazyModules=c}return a.prototype.getMainModule=function(){return this._module},a.prototype.getModules=function(){return this._modules},a.prototype.getLazyModules=function(){return this._lazyModules},a.prototype.issetLazyModule=function(a){return!!this.getLazyModules().hasOwnProperty(a)},a.prototype.hasLazyModules=function(){return!!Object.keys(this.getLazyModules()).length},a.prototype.resolveLazyModule=function(a){this.issetLazyModule(a)&&delete this.getLazyModules()[a]},a.prototype._processModules=function(a){for(var b=this.getMainModule(),c=[],d=0;d<a.length;d++){var e=$.getModule(a[d]).getModule(),f=e.getSettingsManager();f.isPlugin()||$.Error.create('Specified in plugins module "'+a[d]+'" that is not a plugin.'),e.setParent(b),c.push(e)}return c},a.prototype.addPlugin=function(a){var b=this._processModules([a])[0];if(this.issetLazyModule(a)){var c=parseInt(this.getLazyModules()[a])+1;this._modules.splice(c,0,b)}else this._modules.push(b)},a.prototype.getPlugins=function(){for(var a=this.getModules(),b=[],c=0;c<a.length;c++)c>0&&b.push(a[c]);return b},a.prototype.getPluginNames=function(){for(var a=this.getPlugins(),b=[],c=0;c<a.length;c++)b.push(a[c].getName());return b},a.prototype.eachModule=function(a,b){"function"==typeof a&&(b=a,a=!1);var c=$.Tools.extend([],this.getModules());a&&c.reverse();for(var d=0;d<c.length&&b(c[d],c[d].getName())!==!1;d++);},a}(),$.SettingsManager=function(){function a(a){this._module=a,this._plugin=!1,this._pluginOf=null,this._rootPath="",this._files=[],this._events={},this.registerEvent("onInitialize"),this.getEvent("onInitialize").trigger()}return a.$parent=$.Extendable,a.$mixins=[$.Event.EventableMixin],a.prototype.setSettings=function(a){var b=this;if(this.getModule().isReady()&&$.Error.create("Can't change settings in ready module."),a&&!$.Tools.isPlainObject(a)&&$.Error.create("InvalidArgument").argument("the module settings",!1).received(a).expected("a plain object").apply(),a){a.hasOwnProperty("pluginOf")&&this.setPluginOf(a.pluginOf),a.hasOwnProperty("files")&&this.setFiles(a.files);for(var c in a)if(a.hasOwnProperty(c)&&!(["pluginOf","files","onReady"].indexOf(c)>=0)){var d="set"+c[0].toUpperCase()+c.substr(1);this[d]||$.Error.create('Setting option "'+c+'" is not allowed by the module.'),this[d](a[c])}a.hasOwnProperty("onReady")&&b.setOnReady(a.onReady)}},a.prototype.getModule=function(){return this._module},a.prototype.setPlugin=function(a){this.checkModuleIsReady(),"boolean"!=typeof a&&$.Error.create("InvalidModuleOption").option("plugin").module(this.getModule().getName()).received(a).expected("a boolean value").apply(),this._plugin=a},a.prototype.getPlugin=function(){return this._plugin},a.prototype.isPlugin=a.prototype.getPlugin,a.prototype.setPluginOf=function(a){this.checkModuleIsReady(),null!==a&&"string"!=typeof a&&$.Error.create("InvalidModuleOption").option("pluginOf").module(this.getModule().getName()).received(a).expected("a string (name of another module that is not marked as a plugin)").apply(),this._pluginOf=a,this.setPlugin(!0)},a.prototype.getPluginOf=function(){return this._pluginOf},a.prototype.setRootPath=function(a){this.checkModuleIsReady(),"string"!=typeof a&&$.Error.create("InvalidModuleOption").option("rootPath").module(this.getModule().getName()).received(a).expected("a string").apply(),this._rootPath=a},a.prototype.getRootPath=function(){return this._rootPath},a.prototype.setFiles=function(a){this.checkModuleIsReady(),a&&Array.isArray(a)||$.Error.create("Trying to set invalid files array in module settings set. It must contain the names of files.");for(var b=this.getModule(),c=b.getLoadManager(),d=0;d<a.length;d++)c.loadFile(a[d])},a.prototype.hasFiles=function(){return!!this._files.length},a.prototype.setOnSetup=function(a){this.checkModuleIsReady(),"function"!=typeof a&&$.Error.create("InvalidArgument").argument("the callback",!1).received(a).expected("a function").apply();var b=this.getModule().getEventManager(),c=b.getEvent("onSetup");c.addListener(a)},a.prototype.setOnReady=function(a){this.checkModuleIsReady(),"function"!=typeof a&&$.Error.create("InvalidArgument").argument("the callback",!1).received(a).expected("a function").apply();var b=this.getModule(),c=b.getEventManager(),d=c.getEvent("onReady");d.addListener(a)},a.prototype.checkModuleIsReady=function(){this.getModule().isReady()&&$.Error.create("Can't change settings in ready module.")},a}(),$.SubclassPlugin=function(){function a(){}return a.$parent=null,a.getName=function(){$.Error.create("NotImplementedMethod").className("Subclass.SubclassPlugin").method("getName").apply()},a.getDependencies=function(){return[]},a}();window.Subclass=$}();